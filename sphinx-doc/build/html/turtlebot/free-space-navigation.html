

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Turtlebot Free Space Navigation &mdash; Gaitech EDU 2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/gaitech32.jpg"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Gaitech EDU 2.5 documentation" href="../index.html"/>
        <link rel="up" title="Turtlebot Quick Start Tutorials" href="turtlebot-tutorials.html"/>
        <link rel="next" title="Getting Started with Turtlebot Arm PhantomX Pincher with ROS" href="turtlebot-arm-pincher.html"/>
        <link rel="prev" title="Map-Based Navigation" href="map-navigation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Gaitech EDU
          

          
            
            <img src="../_static/gaitechlogo150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-tutorials.html">ROS Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="turtlebot-tutorials.html">Turtlebot Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="turtlebot-first-tests.html">First Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-config-doc.html">Network Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="teleop-doc.html">Keyboard Teleop</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-simulators.html">Turtlebot Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="speech-doc.html">Voice Teleoperation</a></li>
<li class="toctree-l2"><a class="reference internal" href="openKinect-turtlebot.html">Setting-up 3D Sensor for the Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-map-kenict.html">Building a Map with a Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="map-navigation.html">Map Navigation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Turtlebot free movement in Space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-files">Tutorial Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#anaylzing-the-code">Anaylzing the code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#first-approach">First Approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#second-approach">Second Approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#third-approach">Third Approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotate-function">Rotate Function</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-code-using-stage-and-rviz-simulators">Running the code using Stage and RViz Simulators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-pincher.html">Turtlebot Arm PhantomX Pincher with ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-arduino.html">Controlling a Turtlebot Arm with an Arduino Board using RFID</a></li>
<li class="toctree-l2"><a class="reference internal" href="hokuyo-turtlebot.html">Adding Hokuyo Laser Range Finder to Turtlebot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drones/index.html">Drones Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors/index.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gaitech EDU</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="turtlebot-tutorials.html">Turtlebot Quick Start Tutorials</a> &raquo;</li>
      
    <li>Turtlebot Free Space Navigation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/turtlebot/free-space-navigation.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="turtlebot-free-space-navigation">
<span id="free-space-navigation"></span><h1>Turtlebot Free Space Navigation<a class="headerlink" href="#turtlebot-free-space-navigation" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is the first lesson in the series of robot navigation. We consider the case of an open space with no obstacles.</p>
<p>The objective of this tutorial is to learn how to make the Turtlebot robot move using ROS. You will mainly learn how to publish a velocity message to make the robot move for a certain distance, or rotate for a certain angle.
For this, you will create the functions <code class="docutils literal"><span class="pre">move</span></code> and <code class="docutils literal"><span class="pre">rotate</span></code> using different techniques.
In particular, you will learn how to use <code class="docutils literal"><span class="pre">TF</span></code> package to estimate the distance traveled by the robot and the angle rotated by the robot using frame transformations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this tutorial you will learn how to:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Make the robot navigate in an open obstcale-free space</li>
<li>Develop functions to make the robot move straight for a certain distance</li>
<li>Develop functions to make the robot rotate for a certain angle.</li>
<li>use <code class="docutils literal"><span class="pre">TF</span></code> package to estimate the traveled distance and the rotated angle by a robot</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>The objective is to develop functions to make the robot moves in an open space in straight line for a certain distance, and rotate left or right for certain angle.
Using these primitives, it is possible to make the robot move in a free space.</p>
<p>In <a class="reference internal" href="../ros/ros-programming-turtlesim.html#ros-programming-turtlesim"><span class="std std-ref">Turtlesim Cleaning Application</span></a> tutorial, we used the simple equation of <code class="docutils literal"><span class="pre">distance=time*speed</span></code> to make the robot move to a certain distance.
However, this method is not effective in case of a real robot considering the following reason: the inaccuracy of IMU sensor data that provide the speed of the robot in addition to the friction with the ground will
compromise the accuracy of the calculated traveled distance in a certain time duration, which results in an estimation error. This issue is even worse in case of rotation. This estimation error will quickly cumulate over time leading to inacceptable localization error.
Fortunately, in ROS, there is the frame transformation package, denoted as <code class="docutils literal"><span class="pre">tf</span></code> package, that provides several interesting and advanced functionalities to estimate the motion of a frame (in this case the frame attached to the robot), with respect to a fixed frame (i.e the reference frame).
In this tutorial, we will use the <code class="docutils literal"><span class="pre">tf</span></code> package to estimate the traveled distance of the robot, in addition to the rotated angle of the robot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important to have a prior knowledge on frame transformation first to understand the code. Check some online tutorials or ask your instructor.</p>
</div>
</div>
<div class="section" id="tutorial-files">
<h2>Tutorial Files<a class="headerlink" href="#tutorial-files" title="Permalink to this headline">¶</a></h2>
<p>You can find the whole <code class="docutils literal"><span class="pre">cpp</span></code> and <code class="docutils literal"><span class="pre">python</span></code> files in our <a class="reference external" href="https://github.com/aniskoubaa/gaitech_edu">GitHub repository</a>.
They are located in <code class="docutils literal"><span class="pre">src/turtlebot/navigation/free_space_navigation</span></code>.
In particular, we will use the launch file <code class="docutils literal"><span class="pre">free_space_navigation_stage.launch</span></code> that contains all the needed ROS nodes for this tutorial.
Here is the content of the <code class="docutils literal"><span class="pre">free_space_navigation_stage.launch</span></code> file.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&lt;launch&gt;
  &lt;include <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>find turtlebot_stage<span class="k">)</span><span class="s2">/launch/turtlebot_in_stage.launch&quot;</span>/&gt;
  &lt;node <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;free_space_navigation&quot;</span> <span class="nv">pkg</span><span class="o">=</span><span class="s2">&quot;gaitech_edu&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;free_space_navigation_node&quot;</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span>/&gt;
&lt;/launch&gt;
</pre></div>
</div>
<p>In the code you will find 3 <code class="docutils literal"><span class="pre">move</span></code> functions and a <code class="docutils literal"><span class="pre">rotate</span></code> function and each one of them has its own approach so you will be able to know 3 different ways of controlling and manipulating the turtlebot robot .
The code is also well explained so you can easily understand what each line is doing in the code and what is its functionality.</p>
</div>
<div class="section" id="anaylzing-the-code">
<h2>Anaylzing the code<a class="headerlink" href="#anaylzing-the-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="first-approach">
<h3>First Approach<a class="headerlink" href="#first-approach" title="Permalink to this headline">¶</a></h3>
<p>We first analyze the <code class="docutils literal"><span class="pre">move_v1</span></code> function to make the robot moves with a certain speed for a certain distance in stragight line either forward or backward.</p>
<p>The following code below sets the linear speed of the x-axis as positive value if the intention is to move forward, and negative value if the robot is to move backward, based on the value of <code class="docutils literal"><span class="pre">isForward</span></code> boolean variable.
All other linear speeds and angular speeds must be set to zero, because we consider only a straight motion in the x-axis direction.
It has to be noted that the x-axis of the linear speed is the axis that points to the front of the robot from its center.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span> <span class="c1">//set the linear velocity to a positive value if isFoward is true</span>
<span class="k">if</span> <span class="p">(</span><span class="n">isForward</span><span class="p">)</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span><span class="n">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
<span class="k">else</span> <span class="c1">//else set the velocity to negative value to move backward</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=-</span><span class="n">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
<span class="c1">//all velocities of other axes must be zero.</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">//The angular velocity of all axes must be zero because we want  a straight motion</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">isForward</span><span class="p">):</span>
        <span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> <span class="c1">#else set the velocity to negative value to move backward</span>
        <span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=-</span><span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="c1">#all velocities of other axes must be zero.</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span><span class="mf">0.0</span>
</pre></div>
</div>
<p>The following code waits for <code class="docutils literal"><span class="pre">tf::TransformListener</span> <span class="pre">listener</span></code> to find the transformation between the <code class="docutils literal"><span class="pre">/base_footprint</span></code> frame and the <code class="docutils literal"><span class="pre">/odom</span></code> frame, which represents the reference frame.
Then, once the  the transformation is found between the two frames, we save its current state into the <code class="docutils literal"><span class="pre">init_transform</span></code> which is a <code class="docutils literal"><span class="pre">tf::StampedTransform</span></code> object.
In simple words, this object captures the relation between the two frames in terms of translation and relative orientation.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">try</span><span class="p">{</span>
      <span class="c1">//wait for the transform to be found</span>
      <span class="n">listener</span><span class="p">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">);</span>
      <span class="c1">//Once the transform is found,get the initial_transform transformation.</span>
      <span class="n">listener</span><span class="p">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">init_transform</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">catch</span> <span class="p">(</span><span class="n">tf</span><span class="o">::</span><span class="n">TransformException</span> <span class="o">&amp;</span> <span class="n">ex</span><span class="p">){</span>
      <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot; Problem %s&quot;</span><span class="p">,</span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
      <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">).</span><span class="n">sleep</span><span class="p">();</span>
   <span class="p">}</span>
</pre></div>
</div>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
   <span class="c1">#wait for the transform to be found</span>
   <span class="n">listener</span><span class="o">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s2">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s2">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
   <span class="c1">#Once the transform is found,get the initial_transform transformation.</span>
    <span class="n">listener</span><span class="o">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s2">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s2">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">init_transform</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
     <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code estimates the traveled distance.
It is known that the distance is <code class="docutils literal"><span class="pre">sqrt((x1-x0)^2</span> <span class="pre">+</span> <span class="pre">(y1-y0)^2)</span></code>.
<code class="docutils literal"><span class="pre">current_transform</span></code> captures the current transformation between the <code class="docutils literal"><span class="pre">/base_footprint</span></code> and <code class="docutils literal"><span class="pre">/odom</span></code> frames.
Using the <code class="docutils literal"><span class="pre">tf</span></code> function <code class="docutils literal"><span class="pre">getOrigin().x()</span></code> and <code class="docutils literal"><span class="pre">getOrigin().y()</span></code> we can find the <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> coordinates
of the frame <code class="docutils literal"><span class="pre">/base_footprint</span></code> with respect to <code class="docutils literal"><span class="pre">/odom</span></code> frame.
Appying the distance equation, we will be able to find to distance traveled by the robot,
considering that the <code class="docutils literal"><span class="pre">init_transform</span></code> was captured at the moment before starting the motion and
that the <code class="docutils literal"><span class="pre">current_transform</span></code> was captured at the moment of the motion.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">do</span><span class="p">{</span>
    <span class="cm">/***************************************</span>
<span class="cm">    * STEP1. PUBLISH THE VELOCITY MESSAGE</span>
<span class="cm">    ***************************************/</span>
   <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
   <span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
   <span class="cm">/**************************************************</span>
<span class="cm">    * STEP2. ESTIMATE THE DISTANCE MOVED BY THE ROBOT</span>
<span class="cm">    *************************************************/</span>
   <span class="n">try</span><span class="p">{</span>
      <span class="c1">//wait for the transform to be found</span>
      <span class="n">listener</span><span class="p">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">);</span>
      <span class="c1">//Once the transform is found,get the initial_transform transformation.</span>
<span class="hll">      <span class="n">listener</span><span class="p">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">current_transform</span><span class="p">);</span>
</span>   <span class="p">}</span>
   <span class="n">catch</span> <span class="p">(</span><span class="n">tf</span><span class="o">::</span><span class="n">TransformException</span> <span class="o">&amp;</span> <span class="n">ex</span><span class="p">){</span>
      <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot; Problem %s&quot;</span><span class="p">,</span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
      <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">).</span><span class="n">sleep</span><span class="p">();</span>
   <span class="p">}</span>

      <span class="cm">/*</span>
<span class="cm">       * Calculate the distance moved by the robot</span>
<span class="cm">       * There are two methods that give the same result</span>
<span class="cm">       */</span>

      <span class="cm">/*</span>
<span class="cm">       * Method 1: Calculate the distance between the two transformations</span>
<span class="cm">       * Hint:</span>
<span class="cm">       *      --&gt; transform.getOrigin().x(): represents the x coordinate of the transformation</span>
<span class="cm">       *      --&gt; transform.getOrigin().y(): represents the y coordinate of the transformation</span>
<span class="cm">       */</span>
      <span class="c1">//calculate the distance moved</span>
      <span class="n">distance_moved</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">((</span><span class="n">current_transform</span><span class="p">.</span><span class="n">getOrigin</span><span class="p">().</span><span class="n">x</span><span class="p">()</span><span class="o">-</span><span class="n">init_transform</span><span class="p">.</span><span class="n">getOrigin</span><span class="p">().</span><span class="n">x</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">pow</span><span class="p">((</span><span class="n">current_transform</span><span class="p">.</span><span class="n">getOrigin</span><span class="p">().</span><span class="n">y</span><span class="p">()</span><span class="o">-</span><span class="n">init_transform</span><span class="p">.</span><span class="n">getOrigin</span><span class="p">().</span><span class="n">y</span><span class="p">()),</span> <span class="mi">2</span><span class="p">));</span>


   <span class="p">}</span><span class="k">while</span><span class="p">((</span><span class="n">distance_moved</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">()));</span>
</pre></div>
</div>
<p>Note that in Python,  the <code class="docutils literal"><span class="pre">listener.lookupTransform</span></code> is used differently.
In fact, <code class="docutils literal"><span class="pre">listener.lookupTransform('/base_footprint',</span> <span class="pre">'/odom',</span> <span class="pre">rospy.Time(0))</span></code> returns the transformation
from the source frame <code class="docutils literal"><span class="pre">/base_footprint</span></code> to the target frame <code class="docutils literal"><span class="pre">/odom</span></code> at <code class="docutils literal"><span class="pre">rospy.Time(0))rospy.Time(0))</span></code>, which means the latest transofmration.
The transform is returned as a position <code class="docutils literal"><span class="pre">(x,y,z)</span></code> denoted as <code class="docutils literal"><span class="pre">trans</span></code>, and an orientation quaternion <code class="docutils literal"><span class="pre">(x,y,z,w)</span></code>, denoted as <code class="docutils literal"><span class="pre">rot</span></code>.
So, as observed in the code below, <code class="docutils literal"><span class="pre">trans[0]</span></code> represents <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">trans[1]</span></code> represents <code class="docutils literal"><span class="pre">y</span></code>.</p>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span> <span class="k">while</span> <span class="bp">True</span> <span class="p">:</span>
     <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Turtlebot moves forwards&quot;</span><span class="p">)</span>
     <span class="c1">#/***************************************</span>
     <span class="c1"># * STEP1. PUBLISH THE VELOCITY MESSAGE</span>
     <span class="c1"># ***************************************/</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">velocityPublisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">)</span>
     <span class="n">loop_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
     <span class="c1">#/**************************************************</span>
     <span class="c1"># * STEP2. ESTIMATE THE DISTANCE MOVED BY THE ROBOT</span>
     <span class="c1"># *************************************************/</span>
     <span class="k">try</span><span class="p">:</span>

         <span class="c1">#wait for the transform to be found</span>
         <span class="n">listener</span><span class="o">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s2">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s2">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">)</span>
         <span class="c1">#Once the transform is found,get the initial_transform transformation.</span>
         <span class="c1">#listener.lookupTransform(&quot;/base_footprint&quot;, &quot;/odom&quot;,rospy.Time(0))</span>
<span class="hll">         <span class="p">(</span><span class="n">trans</span><span class="p">,</span><span class="n">rot</span><span class="p">)</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s1">&#39;/base_footprint&#39;</span><span class="p">,</span> <span class="s1">&#39;/odom&#39;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span>     <span class="k">except</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
         <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

     <span class="c1"># calculate the distance moved</span>
     <span class="n">end</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">trans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
     <span class="n">distance_moved</span> <span class="o">=</span> <span class="n">distance_moved</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)))</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">distance_moved</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
         <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="section" id="second-approach">
<h3>Second Approach<a class="headerlink" href="#second-approach" title="Permalink to this headline">¶</a></h3>
<p>Now we will analyze the second approach <code class="docutils literal"><span class="pre">move_v2</span></code> function to make the robot moves with a certain speed for a certain distance in straight line either forward or backward.</p>
<p>The second method is based on transformation composition, which is possible in C++.
The idea consists in calculating the relative transform, by multiplying the inverse of the initial transform by the current transform. This is known as transform composition property of coordinate systems.
Then, we use the relative transform to find the displacement of its origin, which represents the traveled distance of the robot.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span> <span class="k">do</span><span class="p">{</span>
 <span class="cm">/***************************************</span>
<span class="cm">  * STEP1. PUBLISH THE VELOCITY MESSAGE</span>
<span class="cm">  ***************************************/</span>
 <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
 <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
 <span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
 <span class="cm">/**************************************************</span>
<span class="cm">  * STEP2. ESTIMATE THE DISTANCE MOVED BY THE ROBOT</span>
<span class="cm">  *************************************************/</span>
 <span class="n">try</span><span class="p">{</span>
   <span class="c1">//wait for the transform to be found</span>
   <span class="n">listener</span><span class="p">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">);</span>
   <span class="c1">//Once the transform is found,get the initial_transform transformation.</span>
   <span class="n">listener</span><span class="p">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;/odom&quot;</span><span class="p">,</span><span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">current_transform</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="n">catch</span> <span class="p">(</span><span class="n">tf</span><span class="o">::</span><span class="n">TransformException</span> <span class="o">&amp;</span> <span class="n">ex</span><span class="p">){</span>
   <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot; Problem %s&quot;</span><span class="p">,</span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">).</span><span class="n">sleep</span><span class="p">();</span>
 <span class="p">}</span>

 <span class="cm">/*</span>
<span class="cm">  * Method 2: using transform composition. We calculate the relative transform, then we determine its length</span>
<span class="cm">  * Hint:</span>
<span class="cm">  *    --&gt; transform.getOrigin().length(): return the displacement of the origin of the transformation</span>
<span class="cm">  */</span>
<span class="hll"> <span class="n">tf</span><span class="o">::</span><span class="n">Transform</span> <span class="n">relative_transform</span> <span class="o">=</span> <span class="n">init_transform</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span> <span class="o">*</span> <span class="n">current_transform</span><span class="p">;</span>
</span><span class="hll"> <span class="n">distance_moved</span><span class="o">=</span> <span class="n">relative_transform</span><span class="p">.</span><span class="n">getOrigin</span><span class="p">().</span><span class="n">length</span><span class="p">();</span>
</span>
 <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;Method 2: distance moved: &quot;</span><span class="o">&lt;&lt;</span><span class="n">distance_moved</span> <span class="o">&lt;&lt;</span><span class="s">&quot;, &quot;</span><span class="o">&lt;&lt;</span><span class="n">distance</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

 <span class="p">}</span><span class="k">while</span><span class="p">((</span><span class="n">distance_moved</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">()));</span>
</pre></div>
</div>
<p>As for the python code, for now, we did not provide an equivalent function to the second approach in python.</p>
</div>
<div class="section" id="third-approach">
<h3>Third Approach<a class="headerlink" href="#third-approach" title="Permalink to this headline">¶</a></h3>
<p>The last function we are going to analyze is the <code class="docutils literal"><span class="pre">move_v3</span></code> function to make the robot moves with a certain speed for a certain distance in stragight line either forward or backward.</p>
<p>The following code below uses the <code class="docutils literal"><span class="pre">pose</span></code> coordinates of the robot to estimate the distance. After declaring the variable in the beginning of the function and equate the initial pose of the turtlebot before start moving with the <code class="docutils literal"><span class="pre">turtlebot_odom_pose</span></code> global variable, you will find the following:</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span>   <span class="c1">//we update the initial_turtlebot_odom_pose using the turtlebot_odom_pose global variable updated in the callback function poseCallback</span>
<span class="hll">   <span class="n">initial_turtlebot_odom_pose</span> <span class="o">=</span> <span class="n">turtlebot_odom_pose</span><span class="p">;</span>
</span>
   <span class="k">do</span><span class="p">{</span>
   <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
   <span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
<span class="hll">   <span class="n">distance_moved</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">((</span><span class="n">turtlebot_odom_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">initial_turtlebot_odom_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
</span><span class="hll">     <span class="n">pow</span><span class="p">((</span><span class="n">turtlebot_odom_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="o">-</span><span class="n">initial_turtlebot_odom_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
</span>
   <span class="p">}</span><span class="k">while</span><span class="p">((</span><span class="n">distance_moved</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">()));</span>
   <span class="c1">//finally, stop the robot when the distance is moved</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
   <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
   <span class="p">}</span>
</pre></div>
</div>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span> <span class="c1">#we update the initial_turtlebot_odom_pose using the turtlebot_odom_pose global variable updated in the callback function poseCallback</span>
 <span class="c1">#we will use deepcopy() to avoid pointers confusion</span>
<span class="hll"> <span class="n">initial_turtlebot_odom_pose</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtlebot_odom_pose</span><span class="p">)</span>
</span>
 <span class="k">while</span> <span class="bp">True</span> <span class="p">:</span>
     <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Turtlebot moves forwards&quot;</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">velocityPublisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">)</span>

     <span class="n">loop_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

     <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="hll">     <span class="n">distance_moved</span> <span class="o">=</span> <span class="n">distance_moved</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">turtlebot_odom_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">initial_turtlebot_odom_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
</span><span class="hll">     <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">turtlebot_odom_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">initial_turtlebot_odom_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
</span>
     <span class="c1">#rospy.loginfo(self.turtlebot_odom_pose.pose.pose.position.x)</span>
     <span class="c1">#rospy.loginfo(initial_turtlebot_odom_pose.pose.pose.position.x)</span>
     <span class="c1">#rospy.loginfo(distance_moved)</span>

     <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">distance_moved</span><span class="o">&lt;</span><span class="n">distance</span><span class="p">):</span>
         <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="section" id="rotate-function">
<h3>Rotate Function<a class="headerlink" href="#rotate-function" title="Permalink to this headline">¶</a></h3>
<p>The following code defines the <code class="docutils literal"><span class="pre">rotate</span></code> function that gives the robot the ability to turn. It starts by delcaring a <code class="docutils literal"><span class="pre">Twist</span></code> message to send velocity commands and a declartion of <code class="docutils literal"><span class="pre">tf</span></code> transform listener to listen and capture the transformation between the <code class="docutils literal"><span class="pre">odom</span></code> frame and the <code class="docutils literal"><span class="pre">base_footprint</span></code> frame. Then change the angles to <code class="docutils literal"><span class="pre">radians</span></code> and then start publishing topics according to the right angles until the robot reaches a certain angle. The <code class="docutils literal"><span class="pre">python</span></code> code is a little different than the <code class="docutils literal"><span class="pre">C++</span></code> code but it does the same functionality.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="nf">rotate</span><span class="p">(</span><span class="kt">double</span> <span class="n">angular_velocity</span><span class="p">,</span> <span class="kt">double</span> <span class="n">radians</span><span class="p">,</span>  <span class="kt">bool</span> <span class="n">clockwise</span><span class="p">)</span>
 <span class="p">{</span>

 <span class="c1">//delcare a Twist message to send velocity commands</span>
 <span class="n">geometry_msgs</span><span class="o">::</span><span class="n">Twist</span> <span class="n">VelocityMessage</span><span class="p">;</span>
 <span class="c1">//declare tf transform listener: this transform listener will be used to listen and capture the transformation between</span>
 <span class="c1">// the odom frame (that represent the reference frame) and the base_footprint frame the represent moving frame</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">TransformListener</span> <span class="n">TFListener</span><span class="p">;</span>
 <span class="c1">//declare tf transform</span>
 <span class="c1">//init_transform: is the transformation before starting the motion</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">StampedTransform</span> <span class="n">init_transform</span><span class="p">;</span>
 <span class="c1">//current_transformation: is the transformation while the robot is moving</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">StampedTransform</span> <span class="n">current_transform</span><span class="p">;</span>
 <span class="c1">//initial coordinates (for method 3)</span>
<span class="hll"> <span class="n">nav_msgs</span><span class="o">::</span><span class="n">Odometry</span> <span class="n">initial_turtlebot_odom_pose</span><span class="p">;</span>
</span>
 <span class="kt">double</span> <span class="n">angle_turned</span> <span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>

 <span class="c1">//validate angular velocity; ANGULAR_VELOCITY_MINIMUM_THRESHOLD is the minimum allowed</span>
 <span class="n">angular_velocity</span><span class="o">=</span><span class="p">((</span><span class="n">angular_velocity</span><span class="o">&gt;</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">)</span><span class="o">?</span><span class="nl">angular_velocity</span><span class="p">:</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">);</span>

 <span class="k">while</span><span class="p">(</span><span class="n">radians</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">radians</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">;</span>
 <span class="k">while</span><span class="p">(</span><span class="n">radians</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">)</span> <span class="n">radians</span> <span class="o">-=</span> <span class="mi">2</span><span class="o">*</span><span class="n">M_PI</span><span class="p">;</span>

 <span class="c1">//wait for the listener to get the first message</span>
 <span class="n">TFListener</span><span class="p">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s">&quot;base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">));</span>


 <span class="c1">//record the starting transform from the odometry to the base frame</span>
 <span class="n">TFListener</span><span class="p">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s">&quot;base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">init_transform</span><span class="p">);</span>


 <span class="c1">//the command will be to turn at 0.75 rad/s</span>
 <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
 <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">angular_velocity</span><span class="p">;</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">clockwise</span><span class="p">)</span> <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>

 <span class="c1">//the axis we want to be rotating by</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">desired_turn_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
 <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clockwise</span><span class="p">)</span> <span class="n">desired_turn_axis</span> <span class="o">=</span> <span class="o">-</span><span class="n">desired_turn_axis</span><span class="p">;</span>

 <span class="n">ros</span><span class="o">::</span><span class="n">Rate</span> <span class="n">rate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span>
 <span class="kt">bool</span> <span class="n">done</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
 <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span> <span class="p">)</span>
 <span class="p">{</span>
 <span class="c1">//send the drive command</span>
 <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
 <span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
 <span class="c1">//get the current transform</span>
 <span class="n">try</span>
 <span class="p">{</span>
   <span class="n">TFListener</span><span class="p">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s">&quot;base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">));</span>
   <span class="n">TFListener</span><span class="p">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s">&quot;base_footprint&quot;</span><span class="p">,</span> <span class="s">&quot;odom&quot;</span><span class="p">,</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">current_transform</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">catch</span> <span class="p">(</span><span class="n">tf</span><span class="o">::</span><span class="n">TransformException</span> <span class="n">ex</span><span class="p">)</span>
   <span class="p">{</span>
   <span class="n">ROS_ERROR</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
   <span class="k">break</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">Transform</span> <span class="n">relative_transform</span> <span class="o">=</span> <span class="n">init_transform</span><span class="p">.</span><span class="n">inverse</span><span class="p">()</span> <span class="o">*</span> <span class="n">current_transform</span><span class="p">;</span>
 <span class="n">tf</span><span class="o">::</span><span class="n">Vector3</span> <span class="n">actual_turn_axis</span> <span class="o">=</span> <span class="n">relative_transform</span><span class="p">.</span><span class="n">getRotation</span><span class="p">().</span><span class="n">getAxis</span><span class="p">();</span>
 <span class="n">angle_turned</span> <span class="o">=</span> <span class="n">relative_transform</span><span class="p">.</span><span class="n">getRotation</span><span class="p">().</span><span class="n">getAngle</span><span class="p">();</span>

 <span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">angle_turned</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">actual_turn_axis</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">desired_turn_axis</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
   <span class="n">angle_turned</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">-</span> <span class="n">angle_turned</span><span class="p">;</span>

 <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clockwise</span><span class="p">)</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">angular_velocity</span><span class="o">-</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">radian2degree</span><span class="p">(</span><span class="n">radians</span><span class="o">-</span><span class="n">angle_turned</span><span class="p">)</span><span class="o">/</span><span class="n">radian2degree</span><span class="p">(</span><span class="n">radians</span><span class="p">)))</span><span class="o">+</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">;</span>
 <span class="k">else</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">clockwise</span><span class="p">)</span>
     <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">angular_velocity</span><span class="o">+</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">radian2degree</span><span class="p">(</span><span class="n">radians</span><span class="o">-</span><span class="n">angle_turned</span><span class="p">)</span><span class="o">/</span><span class="n">radian2degree</span><span class="p">(</span><span class="n">radians</span><span class="p">)))</span><span class="o">-</span><span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">;</span>

 <span class="k">if</span> <span class="p">(</span><span class="n">angle_turned</span> <span class="o">&gt;</span> <span class="n">radians</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">done</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">velocityPublisher</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">VelocityMessage</span><span class="p">);</span>
 <span class="p">}</span>


 <span class="p">}</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="k">return</span> <span class="n">angle_turned</span><span class="p">;</span>
 <span class="k">return</span> <span class="n">angle_turned</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>As for the python, we use <code class="docutils literal"><span class="pre">(trans,rot)</span> <span class="pre">=</span> <span class="pre">listener.lookupTransform('/base_footprint',</span> <span class="pre">'/odom',</span> <span class="pre">rospy.Time(0))</span></code> to get the rotation component in the <code class="docutils literal"><span class="pre">rot</span></code> variable as quaterion.
Then, we extract the yaw component using <code class="docutils literal"><span class="pre">tf.transformations.euler_from_quaternion(rot)</span></code> that converts the quaternion into a RPY Euler notation, which will be used to get the yaw value as it represents the orientation of the robot.
The <code class="docutils literal"><span class="pre">yaw</span></code> is at index <code class="docutils literal"><span class="pre">2</span></code> of the <code class="docutils literal"><span class="pre">euler</span></code> array.</p>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span> <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">angular_velocity</span><span class="p">,</span><span class="n">radians</span><span class="p">,</span><span class="n">clockwise</span><span class="p">):</span>
     <span class="n">rotateMessage</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>

     <span class="c1">#declare tf transform</span>
     <span class="n">listener</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">TransformListener</span><span class="p">()</span>
     <span class="c1">#init_transform: is the transformation before starting the motion</span>
     <span class="n">init_transform</span> <span class="o">=</span> <span class="n">geometry_msgs</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">TransformStamped</span><span class="p">()</span>
     <span class="c1">#current_transformation: is the transformation while the robot is moving</span>
     <span class="n">current_transform</span> <span class="o">=</span> <span class="n">geometry_msgs</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">TransformStamped</span><span class="p">()</span>

     <span class="n">angle_turned</span> <span class="o">=</span> <span class="mf">0.0</span>

     <span class="n">angular_velocity</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">angular_velocity</span><span class="p">,</span> <span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">)[</span><span class="n">angular_velocity</span> <span class="o">&gt;</span> <span class="n">ANGULAR_VELOCITY_MINIMUM_THRESHOLD</span><span class="p">]</span>

     <span class="k">while</span><span class="p">(</span><span class="n">radians</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
         <span class="n">radians</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span> <span class="n">pi</span>

     <span class="k">while</span><span class="p">(</span><span class="n">radians</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span> <span class="n">pi</span><span class="p">):</span>
         <span class="n">radians</span> <span class="o">-=</span> <span class="mi">2</span><span class="o">*</span> <span class="n">pi</span>

     <span class="n">listener</span><span class="o">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s2">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s2">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">)</span>
     <span class="p">(</span><span class="n">trans</span><span class="p">,</span><span class="n">rot</span><span class="p">)</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s1">&#39;/base_footprint&#39;</span><span class="p">,</span> <span class="s1">&#39;/odom&#39;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
     <span class="c1">#listener.lookupTransform(&quot;/base_footprint&quot;, &quot;/odom&quot;, rospy.Time(0),init_transform)</span>

     <span class="n">init_transform</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="n">trans</span>
     <span class="n">init_transform</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span><span class="n">rot</span>

     <span class="c1">#since the rotation is only in the Z-axes</span>
     <span class="c1">#start_angle = tf.transformations.#0.5 * sqrt(rot[2] ** 2)</span>
<span class="hll">     <span class="n">euler</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">euler_from_quaternion</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
</span><span class="hll">     <span class="n">roll</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class="hll">     <span class="n">pitch</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class="hll">     <span class="n">start_angle</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span>
     <span class="n">rotateMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">rotateMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
     <span class="n">rotateMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">angular_velocity</span>

     <span class="k">if</span> <span class="p">(</span><span class="n">clockwise</span><span class="p">):</span>
         <span class="n">rotateMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">rotateMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span>


     <span class="n">loop_rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

     <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
         <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Turtlebot is Rotating&quot;</span><span class="p">)</span>

         <span class="bp">self</span><span class="o">.</span><span class="n">velocityPublisher</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">rotateMessage</span><span class="p">)</span>

         <span class="n">loop_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

         <span class="c1">#rospy.Duration(1.0)</span>

         <span class="k">try</span><span class="p">:</span>

             <span class="c1">#wait for the transform to be found</span>
             <span class="n">listener</span><span class="o">.</span><span class="n">waitForTransform</span><span class="p">(</span><span class="s2">&quot;/base_footprint&quot;</span><span class="p">,</span> <span class="s2">&quot;/odom&quot;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span> <span class="p">)</span>
             <span class="c1">#Once the transform is found,get the initial_transform transformation.</span>
             <span class="c1">#listener.lookupTransform(&quot;/base_footprint&quot;, &quot;/odom&quot;,rospy.Time(0))</span>
             <span class="p">(</span><span class="n">trans</span><span class="p">,</span><span class="n">rot</span><span class="p">)</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="n">lookupTransform</span><span class="p">(</span><span class="s1">&#39;/base_footprint&#39;</span><span class="p">,</span> <span class="s1">&#39;/odom&#39;</span><span class="p">,</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
         <span class="k">except</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
             <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

         <span class="n">current_transform</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span> <span class="o">=</span> <span class="n">trans</span>
         <span class="n">current_transform</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span><span class="n">rot</span>

         <span class="c1">#since the rotation is only in the Z-axes</span>
         <span class="c1">#end_angle = 0.5 * sqrt( rot[2] ** 2)</span>
<span class="hll">         <span class="n">euler</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">euler_from_quaternion</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
</span><span class="hll">         <span class="n">roll</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class="hll">         <span class="n">pitch</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class="hll">         <span class="n">end_angle</span> <span class="o">=</span> <span class="n">euler</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span>
         <span class="n">angle_turned</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">end_angle</span> <span class="o">-</span> <span class="n">start_angle</span><span class="p">)</span>
         <span class="k">print</span> <span class="s2">&quot;angle_turned: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">angle_turned</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">angle_turned</span> <span class="o">&gt;</span> <span class="n">radians</span><span class="p">):</span>
             <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-the-code-using-stage-and-rviz-simulators">
<h2>Running the code using Stage and RViz Simulators<a class="headerlink" href="#running-the-code-using-stage-and-rviz-simulators" title="Permalink to this headline">¶</a></h2>
<p>Bring up your simulator:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_stage turtlebot_in_stage.launch
</pre></div>
</div>
<p>If your PC is not fast enough to run the <cite>Stage</cite> with <cite>RViz</cite> you can run only the <cite>Stage</cite> using this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_stage turtlebot_in_stage_no_rviz.launch
</pre></div>
</div>
<p>After that run the <code class="docutils literal"><span class="pre">cpp</span></code> node by typing the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_edu free_space_navigation
</pre></div>
</div>
<p>or launch the <code class="docutils literal"><span class="pre">free_space_navigation_stage.launch</span></code> file to launch the simulators and the <code class="docutils literal"><span class="pre">cpp</span></code> node.</p>
<img alt="../_images/stage-square-move-cpp.png" class="align-center" src="../_images/stage-square-move-cpp.png" />
<p>You can also choose to run the <code class="docutils literal"><span class="pre">python</span></code> script by running this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python your_workspace/src/gaitech_edu/src/turtlebot/navigation/free_space_navigation/script/free_space_navigation.py
</pre></div>
</div>
<p>Or you can launch the <code class="docutils literal"><span class="pre">free_space_navigation_stage_python_node.launch</span></code> file to run the simulators and the <code class="docutils literal"><span class="pre">python</span></code> node.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_edu free_space_navigation_stage_python_node.launch
</pre></div>
</div>
<img alt="../_images/stage-square-move-python.png" class="align-center" src="../_images/stage-square-move-python.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You can try the three <code class="docutils literal"><span class="pre">move</span></code> methods by calling each one of them in the <code class="docutils literal"><span class="pre">moveSquare</span></code> method.
You can try the same codes with <cite>Gazebo</cite> simulator but you need to have a fast PC. All you have to do is to launch <cite>Gazebo</cite> by typing the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_gazebo turtlebot_world.launch
</pre></div>
</div>
<p class="last">Then run either one of the files as mentioned above.</p>
</div>
<iframe width="640" height="360" src="http://www.youtube.com/embed/SHPCyqFDr1Q" frameborder="0" allowfullscreen="1">&nbsp;</iframe></div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="turtlebot-arm-pincher.html" class="btn btn-neutral float-right" title="Getting Started with Turtlebot Arm PhantomX Pincher with ROS" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="map-navigation.html" class="btn btn-neutral" title="Map-Based Navigation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gaitech.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>