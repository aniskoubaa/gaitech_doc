

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ROS OpenCV with Turtlebot &mdash; Gaitech EDU 2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/gaitech32.jpg"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Gaitech EDU 2.5 documentation" href="../index.html"/>
        <link rel="up" title="Turtlebot Quick Start Tutorials" href="turtlebot-tutorials.html"/>
        <link rel="next" title="Turtlebot Line Follower" href="line-follower.html"/>
        <link rel="prev" title="Turtlebot Free Space Navigation" href="free-space-navigation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Gaitech EDU
          

          
            
            <img src="../_static/gaitechlogo150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-tutorials.html">ROS Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="turtlebot-tutorials.html">Turtlebot Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="turtlebot-first-tests.html">First Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-config-doc.html">Network Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="teleop-doc.html">Keyboard Teleop</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-simulators.html">Turtlebot Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="speech-doc.html">Voice Teleoperation</a></li>
<li class="toctree-l2"><a class="reference internal" href="openKinect-turtlebot.html">Setting-up 3D Sensor for the Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-map-kenict.html">Building a Map with a Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="map-navigation.html">Map Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="free-space-navigation.html">Turtlebot free movement in Space</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ROS OpenCV with Turtlebot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-opencv-packages">Installing OpenCV packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform-image-from-ros-to-opencv">Transform Image from ROS to OpenCV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="line-follower.html">Line Follower</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-pincher.html">Turtlebot Arm PhantomX Pincher with ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-arduino.html">Controlling a Turtlebot Arm with an Arduino Board using RFID</a></li>
<li class="toctree-l2"><a class="reference internal" href="hokuyo-turtlebot.html">Adding Hokuyo Laser Range Finder to Turtlebot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drones/index.html">Drones Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors/index.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gaitech EDU</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="turtlebot-tutorials.html">Turtlebot Quick Start Tutorials</a> &raquo;</li>
      
    <li>ROS OpenCV with Turtlebot</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/turtlebot/openCV-turtlebot.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ros-opencv-with-turtlebot">
<span id="opencv-turtlebot"></span><h1>ROS OpenCV with Turtlebot<a class="headerlink" href="#ros-opencv-with-turtlebot" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial you will learn how to configure your turtlebot robot with OpenCV to stream videos from Microsoft Kinect.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>Make sure that you completed installing all the required packages in the previous tutorials, your network set-up is working fine between the ROS Master node and the host node.</li>
<li>Make sure to complete the ROS OpenKinect with Turtlebot tutorial.</li>
</ul>
</div>
<div class="section" id="installing-opencv-packages">
<h2>Installing OpenCV packages<a class="headerlink" href="#installing-opencv-packages" title="Permalink to this headline">¶</a></h2>
<p>You need to download the OpenCV packages by running the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install ros-indigo-vision-opencv libopencv-dev <span class="se">\ </span>python-opencv
rospack profile
</pre></div>
</div>
<p>After installation type this command to make sure that you have successfully installed the packages:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python
&gt;&gt;&gt; from cv2 import cv
&gt;&gt;&gt; quit<span class="o">()</span>
</pre></div>
</div>
<p>You can type the following command to make sure that the OpenCV Python library is installed in its proper location:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>locate cv2.so <span class="p">|</span> grep python
</pre></div>
</div>
<p>You will get an output like this:</p>
<img alt="../_images/openCV-python.png" class="align-center" src="../_images/openCV-python.png" />
</div>
<div class="section" id="transform-image-from-ros-to-opencv">
<h2>Transform Image from ROS to OpenCV<a class="headerlink" href="#transform-image-from-ros-to-opencv" title="Permalink to this headline">¶</a></h2>
<p>In this section you will learn how to recieve and transform images from ROS and transform them to OpenCV.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure that you downloaded the <code class="docutils literal"><span class="pre">gaitech_doc</span></code> package from our GitHub <a class="reference external" href="https://github.com/aniskoubaa/gaitech_doc">repository</a></p>
</div>
<p>You will find a launch file called <code class="docutils literal"><span class="pre">turtlebot_openCV</span></code> in the following path <code class="docutils literal"><span class="pre">gaitech_doc/src/turtlebot/openCV/launch/turtlebot_openCV.launch</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>&lt;launch&gt;
        &lt;node <span class="nv">pkg</span><span class="o">=</span><span class="s2">&quot;gaitech_doc&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;turtlebot_openCV&quot;</span> <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;turtlebot_openCV.py&quot;</span> <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;screen&quot;</span>&gt;
        &lt;remap <span class="nv">from</span><span class="o">=</span><span class="s2">&quot;input_rgb_image&quot;</span> <span class="nv">to</span><span class="o">=</span><span class="s2">&quot;/camera/rgb/image_raw&quot;</span> /&gt;
        &lt;remap <span class="nv">from</span><span class="o">=</span><span class="s2">&quot;input_depth_image&quot;</span> <span class="nv">to</span><span class="o">=</span><span class="s2">&quot;/camera/depth/image_rect&quot;</span> /&gt;
        &lt;/node&gt;
&lt;/launch&gt;
</pre></div>
</div>
<p>Run the file in a terminal:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc turtlebot_openCV.launch
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Make sure that your camera driver is running.</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>roslaunch freenect_launch freenect.launch
</pre></div>
</div>
</div>
<p>This file will run a python script called <code class="docutils literal"><span class="pre">turtlebot_openCV.py</span></code> and you can find the file in the following path <code class="docutils literal"><span class="pre">gaitech_doc/src/turtlebot/openCV/scripts/turtlebot_openCV.py</span></code>. The code is well documented but we will have a look at a couple of parts of it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">cv2.cv</span> <span class="kn">as</span> <span class="nn">cv</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">CameraInfo</span>
<span class="kn">from</span> <span class="nn">cv_bridge</span> <span class="kn">import</span> <span class="n">CvBridge</span><span class="p">,</span> <span class="n">CvBridgeError</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>All the OpenCV scripts have to import the <code class="docutils literal"><span class="pre">cv2</span></code> and the older version of it <code class="docutils literal"><span class="pre">cv2.cv</span></code> as it has some functions needed. The <code class="docutils literal"><span class="pre">Image</span></code> and <code class="docutils literal"><span class="pre">CamerInfo</span></code> are used for ROS messages. To be able to convert from ROS to OpenCV you need to import the <code class="docutils literal"><span class="pre">CvBridge</span></code> and <code class="docutils literal"><span class="pre">CvBridgeError</span></code> from the <code class="docutils literal"><span class="pre">cv_bridge</span></code> package. As for the last import <code class="docutils literal"><span class="pre">numpy</span></code>, it is used because OpenCV use it to process the images.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Create the OpenCV display window for the RGB image</span>
<span class="bp">self</span><span class="o">.</span><span class="n">cv_window_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span>
<span class="n">cv</span><span class="o">.</span><span class="n">NamedWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_window_name</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_WINDOW_NORMAL</span><span class="p">)</span>
<span class="n">cv</span><span class="o">.</span><span class="n">MoveWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_window_name</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>

<span class="c1"># And one for the depth image</span>
<span class="n">cv</span><span class="o">.</span><span class="n">NamedWindow</span><span class="p">(</span><span class="s2">&quot;Depth Image&quot;</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_WINDOW_NORMAL</span><span class="p">)</span>
<span class="n">cv</span><span class="o">.</span><span class="n">MoveWindow</span><span class="p">(</span><span class="s2">&quot;Depth Image&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">350</span><span class="p">)</span>
</pre></div>
</div>
<p>This part is to initialize the two windows to display the images on.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">image_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="c1"># Use cv_bridge() to convert the ROS image to OpenCV format</span>
    <span class="c1"># Convert the ROS image to OpenCV format using a cv_bridge helper function</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Process the image to detect and track objects or features</span>
    <span class="n">processed_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_image</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># If the result is a greyscale image, convert to 3-channel for display purposes &quot;&quot;&quot;</span>
    <span class="c1">#if processed_image.channels == 1:</span>
        <span class="c1">#cv.CvtColor(processed_image, self.processed_image, cv.CV_GRAY2BGR)</span>

    <span class="c1"># Display the image.</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="n">processed_image</span><span class="p">)</span>

    <span class="c1"># Process any keyboard commands</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">keystroke</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keystroke</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keystroke</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
            <span class="c1"># The user has press the q key, so exit</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">signal_shutdown</span><span class="p">(</span><span class="s2">&quot;User hit q key to quit.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">depth_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ros_image</span><span class="p">):</span>
    <span class="c1"># Use cv_bridge() to convert the ROS image to OpenCV format</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert the depth image using the default passthrough encoding</span>
        <span class="n">depth_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">imgmsg_to_cv2</span><span class="p">(</span><span class="n">ros_image</span><span class="p">,</span> <span class="s2">&quot;passthrough&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">CvBridgeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">e</span>

    <span class="c1"># Convert the depth image to a Numpy array since most cv2 functions require Numpy arrays.</span>
    <span class="n">depth_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">depth_image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Normalize the depth image to fall between 0 (black) and 1 (white)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">depth_array</span><span class="p">,</span> <span class="n">depth_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>

    <span class="c1"># Process the depth image</span>
    <span class="n">depth_display_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_depth_image</span><span class="p">(</span><span class="n">depth_array</span><span class="p">)</span>

    <span class="c1"># Display the result</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Depth Image&quot;</span><span class="p">,</span> <span class="n">depth_display_image</span><span class="p">)</span>
</pre></div>
</div>
<p>As menthioned before that this program will display two windows, one for the Image and one for the Depth Image so each methods of them is for its Image processing, converting and displaying</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For more details about <code class="docutils literal"><span class="pre">cv_bridge</span></code> and <code class="docutils literal"><span class="pre">OpenCV</span></code> on ROS, please refer to the following ROS documentation pages:</p>
<blockquote class="last">
<div><ul class="simple">
<li><a class="reference external" href="http://wiki.ros.org/cv_bridge">cv_bridge</a>: A package that is used to convert between ROS images and OpenCV images.</li>
<li><a class="reference external" href="https://github.com/opencv/opencv/wiki">openCV</a>: A package of programming functions for realtime computer vision.</li>
</ul>
</div></blockquote>
</div>
<p>After a short time you will see some thing like this:</p>
<img alt="../_images/openCV.png" class="align-center" src="../_images/openCV.png" />
<p>To understand the whole process of transformation you can open the <code class="docutils literal"><span class="pre">python</span></code> script in the following path <code class="docutils literal"><span class="pre">gaitech_doc/src/turtlebot/openCV/scripts/turtlebot_openCV.py</span></code> , the file is well documented so you will be able to understand everything written inside the code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This code is originally from the <code class="docutils literal"><span class="pre">cv_bridge_opencv.py</span></code> file in the <code class="docutils literal"><span class="pre">rbx1_vision</span></code> package but with some other modifications.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="line-follower.html" class="btn btn-neutral float-right" title="Turtlebot Line Follower" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="free-space-navigation.html" class="btn btn-neutral" title="Turtlebot Free Space Navigation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gaitech.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>