

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setting-up 3D Sensor for the Turtlebot &mdash; Gaitech EDU 2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/gaitech32.jpg"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Gaitech EDU 2.5 documentation" href="../index.html"/>
        <link rel="up" title="Turtlebot Quick Start Tutorials" href="turtlebot-tutorials.html"/>
        <link rel="next" title="Building a Map with a Turtlebot" href="create-map-kenict.html"/>
        <link rel="prev" title="Turtlebot Voice Teleoperation" href="speech-doc.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Gaitech EDU
          

          
            
            <img src="../_static/gaitechlogo150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-tutorials.html">ROS Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roslink/index.html">ROSLink</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="turtlebot-tutorials.html">Turtlebot Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="turtlebot-first-tests.html">First Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-config-doc.html">Network Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="teleop-doc.html">Keyboard Teleop</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-simulators.html">Turtlebot Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="speech-doc.html">Voice Teleoperation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setting-up 3D Sensor for the Turtlebot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#asus-xtion-pro-live-3d-sensor">Asus Xtion Pro Live 3D Sensor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-openni-package">Installing the Openni Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="#explanning-the-3dsensor-launch-file">Explanning the 3dsensor.launch File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-the-asus-sensor">Testing the Asus Sensor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kinect-3d-sensor">Kinect 3D Sensor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kinect-3d-sensor-configuration">Kinect 3D sensor configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-ros-openni-and-openkinect-drivers">Installing ROS OpenNI and OpenKinect Drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing-your-3d-sensor-valid-for-both-asus-and-kinect">Testing Your 3D Sensor (Valid for Both Asus and Kinect)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="create-map-kenict.html">Building a Map with a Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="map-navigation.html">Map Navigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="free-space-navigation.html">Turtlebot free movement in Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-pincher.html">Turtlebot Arm PhantomX Pincher with ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-arduino.html">Controlling a Turtlebot Arm with an Arduino Board using RFID</a></li>
<li class="toctree-l2"><a class="reference internal" href="hokuyo-turtlebot.html">Adding Hokuyo Laser Range Finder to Turtlebot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drones/index.html">Drones Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gapter/index.html">Gapter Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video/index.html">Video Streaming Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dronemap/index.html">Dronemap Planner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors/index.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gaitech EDU</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="turtlebot-tutorials.html">Turtlebot Quick Start Tutorials</a> &raquo;</li>
      
    <li>Setting-up 3D Sensor for the Turtlebot</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/turtlebot/openKinect-turtlebot.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setting-up-3d-sensor-for-the-turtlebot">
<span id="openkinect-turtlebot"></span><h1>Setting-up 3D Sensor for the Turtlebot<a class="headerlink" href="#setting-up-3d-sensor-for-the-turtlebot" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial you will learn how to configure your turtlebot robot to display image from 3D sensor, including Asus Xtion Pro Live camera and Kinect Camera.
Prio to ROS Indigo, the Turtlebot ROS package provided a default support for Kinect camera.
However, for ROS Indigo and later versions, Turtlebot package provides a default support for Asus Xtion Pro Live 3D sensor,
and it requires some additional configuration to work with Kinect.
In this tutorial, we will introduce how to set-up and test both sensors for ROS Indigo and later versions.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you completed installing all the required packages in the previous tutorials, your network set-up is working fine between the ROS Master node and the host node.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this tutorial you will learn how to:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Set-up, configure and test Asus Xtion Pro Live 3D sensor for a Turtlebot</li>
<li>Set-up, configure and test Kinect Xbox 360 sensor for a Turtlebot</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="asus-xtion-pro-live-3d-sensor">
<h2>Asus Xtion Pro Live 3D Sensor<a class="headerlink" href="#asus-xtion-pro-live-3d-sensor" title="Permalink to this headline">¶</a></h2>
<p>The default sensor that is used with ROS Indigo is the Asus Xtion Pro Live 3D sensor. The image below is for the Asus sensor.</p>
<img alt="../_images/asus_camera.png" class="align-center" src="../_images/asus_camera.png" />
<p>If Asus is not your default 3Dsensor, then, to use this sensor with the turtlebot robot you will have to add the following lines in the <code class="docutils literal"><span class="pre">.bashrc</span></code> script file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">TURTLEBOT_3D_SENSOR</span><span class="o">=</span>asus_xtion_pro
</pre></div>
</div>
<p>Remember that if you work with ROS Indigo and later version, you do not need to make the above command, as it is the default 3D sensor, unless you already changed it to another setting.</p>
<div class="section" id="installing-the-openni-package">
<h3>Installing the Openni Package<a class="headerlink" href="#installing-the-openni-package" title="Permalink to this headline">¶</a></h3>
<p>If you are going to use the Asus sensor then you will need to install the <code class="docutils literal"><span class="pre">openni</span></code> package, so run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install ros-indigo-openni-* ros-indigo-openni2-*
</pre></div>
</div>
<p>Both the packages will be installed in the same folder and you can find this file in the following path <code class="docutils literal"><span class="pre">/opt/ros/indigo/share/openni2_camera</span></code> and <code class="docutils literal"><span class="pre">/opt/ros/indigo/share/openni_camera</span></code>. You will find more <code class="docutils literal"><span class="pre">oppeni</span></code> folders which also belongs to the same package.
Note that this is the package that is responsible for running the 3D sensor. Prio to ROS Indigo, this ROS package was configured to start Kinect 3D sensor by default. However, for ROS Indigo and later versions, it was configured to run Asus Live Pro 3D sensor by defaut.
If you want to use Kinect 3D sensor with your Turtlebot on ROS Indigo and later version, refer to the next section <a class="reference internal" href="#kinect3d"><span class="std std-ref">Kinect 3D Sensor</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For more details about openni on ROS, please refer to the following ROS documentation pages:</p>
<blockquote class="last">
<div><ul class="simple">
<li><a class="reference external" href="http://wiki.ros.org/openni_launch">openni_launch</a>: Launch files to open an OpenNI device and load all nodelets to convert raw depth/RGB/IR streams to depth images, disparity images, and (registered) point clouds</li>
<li><a class="reference external" href="http://wiki.ros.org/openni_camera">openni_camera</a>: A ROS driver for OpenNI depth (+ RGB) cameras. These include: Microsoft Kinect, PrimeSense PSDK, ASUS Xtion Pro and Pro Live The driver publishes raw depth, RGB, and IR image streams.</li>
<li><a class="reference external" href="http://wiki.ros.org/openni_launch/Tutorials/QuickStart">QuickStart Tutorial</a>: This tutorial demonstrates how to open a Kinect (or other OpenNI device) in ROS, introduces ROS tools for visualization and configuration, and explains how to get registered (depth + RGB) outputs like color point clouds.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="explanning-the-3dsensor-launch-file">
<h3>Explanning the 3dsensor.launch File<a class="headerlink" href="#explanning-the-3dsensor-launch-file" title="Permalink to this headline">¶</a></h3>
<p>You will find the file by typing the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roscd turtlebot_bringup/launch/
sudo gedit 3dsensor.launch
</pre></div>
</div>
<p>The code is well explained but we will have a look at the following point in the code.
In line number 21 :</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;3d_sensor&quot;</span>   <span class="na">default=</span><span class="s">&quot;$(env TURTLEBOT_3D_SENSOR)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- kinect, asus_xtion_pro --&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">TURTLEBOT_3D_SENSOR</span></code> environment variable is set in the previous steps in the <code class="docutils literal"><span class="pre">.bashrc</span></code> file according to your sensor type.
Note that the value of this variable will affect more setting parameters for the initialization of the 3D sensor afterwards in the same <code class="docutils literal"><span class="pre">.launch</span></code> file.</p>
</div>
<div class="section" id="testing-the-asus-sensor">
<h3>Testing the Asus Sensor<a class="headerlink" href="#testing-the-asus-sensor" title="Permalink to this headline">¶</a></h3>
<p>After all the installation steps you can test your environment by typing the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_bringup 3dsensor.launch
roslaunch turtlebot_rviz_launchers view_robot.launch
</pre></div>
</div>
<p>After launching the <code class="docutils literal"><span class="pre">RViz</span></code> simulator (<code class="docutils literal"><span class="pre">rosrun</span> <span class="pre">rviz</span> <span class="pre">rviz</span></code>) press on the <code class="docutils literal"><span class="pre">Image</span></code> icon on the left list and you would be able to see something like this:</p>
<img alt="../_images/rviz_camera.png" class="align-center" src="../_images/rviz_camera.png" />
<p>You can also launch the <code class="docutils literal"><span class="pre">image_view</span></code> program to vizualize the video streams:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun image_view image_view image:<span class="o">=</span>/camera/rgb/image_raw
</pre></div>
</div>
</div>
</div>
<div class="section" id="kinect-3d-sensor">
<span id="kinect3d"></span><h2>Kinect 3D Sensor<a class="headerlink" href="#kinect-3d-sensor" title="Permalink to this headline">¶</a></h2>
<p>By default, ROS indigo supports <code class="docutils literal"><span class="pre">Asus</span> <span class="pre">Live</span> <span class="pre">Pro</span></code> 3D sensor and has no default support to <code class="docutils literal"><span class="pre">Kinect</span></code> 3D sensor.
If you use <code class="docutils literal"><span class="pre">Asus</span> <span class="pre">Live</span> <span class="pre">Pro</span></code> 3D sensor, then skip the Kinect configuration step below. If you use <code class="docutils literal"><span class="pre">Kinect</span></code> 3D sensor, then follow the steps below to configure correctly your Turtlebot robot with it.
The following image is for the <code class="docutils literal"><span class="pre">Kinect</span></code> 3D sensor:</p>
<img alt="../_images/kinect_camera.jpg" class="align-center" src="../_images/kinect_camera.jpg" />
<div class="section" id="kinect-3d-sensor-configuration">
<h3>Kinect 3D sensor configuration<a class="headerlink" href="#kinect-3d-sensor-configuration" title="Permalink to this headline">¶</a></h3>
<p>In order to connect the <code class="docutils literal"><span class="pre">Kinect</span></code> sensor with the ROS Indigo environment, you can type the following three commands in your <code class="docutils literal"><span class="pre">.bashrc</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">TURTLEBOT_3D_SENSOR</span><span class="o">=</span>kinect
</pre></div>
</div>
<p>Then save, exit and close the terminal. Open a new terminal.</p>
</div>
<div class="section" id="installing-ros-openni-and-openkinect-drivers">
<h3>Installing ROS OpenNI and OpenKinect Drivers<a class="headerlink" href="#installing-ros-openni-and-openkinect-drivers" title="Permalink to this headline">¶</a></h3>
<p>First, you need to download the ROS OpenNI and OpenKinect (freenect) drivers by running the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install ros-indigo-openni-* ros-indigo-openni2-* <span class="se">\ </span>ros-indigo-freenect-*
rospack profile
</pre></div>
</div>
<p>Now you can test your camera. Type the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch freenect_launch freenect.launch
</pre></div>
</div>
<p>You should see these lines in the terminal:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>process<span class="o">[</span>camera/camera_nodelet_manager-1<span class="o">]</span>: started with pid <span class="o">[</span><span class="m">18070</span><span class="o">]</span>
<span class="o">[</span>INFO<span class="o">]</span> <span class="o">[</span><span class="m">1420555647</span>.969035762<span class="o">]</span>: Initializing nodelet with <span class="m">4</span> worker
threads.
process<span class="o">[</span>camera/driver-2<span class="o">]</span>: started with pid <span class="o">[</span><span class="m">18078</span><span class="o">]</span>
Warning: USB events thread - failed to <span class="nb">set</span> priority. This might cause
loss of data...
process<span class="o">[</span>camera/rectify_color-3<span class="o">]</span>: started with pid <span class="o">[</span><span class="m">18112</span><span class="o">]</span>
process<span class="o">[</span>camera/depth_rectify_depth-4<span class="o">]</span>: started with pid <span class="o">[</span><span class="m">18126</span><span class="o">]</span>
etc.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not worry about the warning appearing in the terminal after running the previous command.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For more details about openni on ROS, please refer to the following ROS documentation pages:</p>
<blockquote class="last">
<div><ul class="simple">
<li><a class="reference external" href="http://wiki.ros.org/libfreenect">libfreenect</a>: <a class="reference external" href="http://openkinect.org/wiki/Main_Page">freenect</a> is a library for accessing the Microsoft Kinect USB camera.</li>
<li><a class="reference external" href="http://wiki.ros.org/freenect_launch">freenect_launch</a>: This package contains launch files for using a Microsoft Kinect using the libfreenect library. This folder replicates the API offered by openni_launch in an effort to maintain maximum compatibility with the OpenNI driver.</li>
<li><a class="reference external" href="https://openkinect.org/wiki/Getting_Started">OpenKinect WiKi</a>: This page documents how to get started using OpenKinect.</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="testing-your-3d-sensor-valid-for-both-asus-and-kinect">
<h2>Testing Your 3D Sensor (Valid for Both Asus and Kinect)<a class="headerlink" href="#testing-your-3d-sensor-valid-for-both-asus-and-kinect" title="Permalink to this headline">¶</a></h2>
<p>After running the previous command, you can now run the following command to know all the topics published by the camera:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rostopic list
</pre></div>
</div>
<p>The following examples are to demonstrate the difference between a couple of topics:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li>To test the RGB image from camera type the following command:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun image_view image_view image:<span class="o">=</span>/camera/rgb/image_raw
</pre></div>
</div>
<p>You will see something like this:</p>
<img alt="../_images/camera-rgb.png" class="align-center" src="../_images/camera-rgb.png" />
<ul class="simple">
<li>To test the Mono image from camera type the following command:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun image_view image_view image:<span class="o">=</span>/camera/rgb/image_rect_mono
</pre></div>
</div>
<p>You will see something like this:</p>
<img alt="../_images/camera-mono.png" class="align-center" src="../_images/camera-mono.png" />
<ul class="simple">
<li>To test the depth image from camera type the following command:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun image_view image_view image:<span class="o">=</span>/camera/depth/image_rect
</pre></div>
</div>
<p>You will see something like this:</p>
<img alt="../_images/camera-depth.png" class="align-center" src="../_images/camera-depth.png" />
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The darker the object is the closer it is to the turtlebot.</p>
</div>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create-map-kenict.html" class="btn btn-neutral float-right" title="Building a Map with a Turtlebot" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="speech-doc.html" class="btn btn-neutral" title="Turtlebot Voice Teleoperation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gaitech.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>