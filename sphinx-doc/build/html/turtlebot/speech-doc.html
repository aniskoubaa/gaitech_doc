

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Turtlebot Voice Teleoperation &mdash; Gaitech Doc 2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/gaitech32.jpg"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Gaitech Doc 2.5 documentation" href="../index.html"/>
        <link rel="up" title="Turtlebot Quick Start Tutorials" href="turtlebot-tutorials.html"/>
        <link rel="next" title="Sending Goals to the Navigation Stack" href="send-goals-nav-stack.html"/>
        <link rel="prev" title="Turtlebot First Tests" href="turtlebot-first-tests.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Gaitech Doc
          

          
            
            <img src="../_static/gaitechlogo150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-background.html">ROS Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-programming-basics.html">Getting Started with ROS Programming</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="turtlebot-tutorials.html">Turtlebot Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="network-config-doc.html">Network Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot_simulators.html">Turtlebot Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="teleop-doc.html">Keyboard Teleop</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-first-tests.html">First Tests</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Speech Recognition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-pocketsphinx-for-speech-recognition">Install PocketSphinx for Speech Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-the-pocketsphinx-recognizer">Test the PocketSphinx Recognizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-and-dependencies">Code and dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-your-vocabulary-of-commands">Create Your Vocabulary of Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-voice-control-navigation-script">A Voice-Control Navigation Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-explanation">Code Explanation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-the-voice-control-in-the-gazebo-and-stage-simulators">Testing the Voice-Control in the Gazebo and Stage Simulators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-the-voice-control-with-a-turtlebot-robot">Testing the Voice-Control with a Turtlebot Robot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="send-goals-nav-stack.html">Send Goals to Navigation Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-map.html">Building a map using Logged Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drones/index.html">Drones Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gaitech Doc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="turtlebot-tutorials.html">Turtlebot Quick Start Tutorials</a> &raquo;</li>
      
    <li>Turtlebot Voice Teleoperation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/turtlebot/speech-doc.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="turtlebot-voice-teleoperation">
<span id="speech-doc"></span><h1>Turtlebot Voice Teleoperation<a class="headerlink" href="#turtlebot-voice-teleoperation" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will introduce how to control your turtlebot robot using speech recognition.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you completed installing all the required packages in the previous tutorials and your network set-up is working fine between the ROS Master node and the host node.</p>
</div>
<p>In this tutorial you will learn how to:</p>
<blockquote>
<div><ul class="simple">
<li>Teleoprate a real and simulated turtlebot with voice commands</li>
<li>Create a custom voice-command vocabulary</li>
<li>Work with pocket-sphinx package in ROS</li>
</ul>
</div></blockquote>
<div class="section" id="install-pocketsphinx-for-speech-recognition">
<h2>Install PocketSphinx for Speech Recognition<a class="headerlink" href="#install-pocketsphinx-for-speech-recognition" title="Permalink to this headline">¶</a></h2>
<p>In order to download the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package on Ubuntu you need to install the <code class="docutils literal"><span class="pre">gstreamer0.10-pocketsphinx</span></code> and the ROS sound drivers.</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>sudo apt-get install gstreamer0.10-pocketsphinx
sudo apt-get install ros-indigo-pocketsphinx
sudo apt-get install ros-indigo-audio-common
sudo apt-get install libasound2
</pre></div>
</div>
<p>You do not need to worry about connecting the audio input stream with your PC or publishing a topic because the node recognizer.py in the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package does all the work for you.</p>
</div>
<div class="section" id="test-the-pocketsphinx-recognizer">
<h2>Test the PocketSphinx Recognizer<a class="headerlink" href="#test-the-pocketsphinx-recognizer" title="Permalink to this headline">¶</a></h2>
<p>First, you need to test of the recognizer is working. To get the best result it is better to have an external Mic connected to you PC either by USB, standard audio or Bluetooth.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure that the Mic you are using is the one that is selected in the sound settings in your PC. Try to test your Mic before hands to make sure that the quality is good and check the volume meter.</p>
</div>
<p>Note that <code class="docutils literal"><span class="pre">pocketsphinx</span></code> comes as a packages in ROS Indigo. For more details, refer to <a class="reference external" href="http://wiki.ros.org/pocketsphinx">the pocketsphinx package</a> on ROS WiKi.
You can find browse the directory of <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package with the command:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roscd pocketsphinx
</pre></div>
</div>
<p>In the directory <code class="docutils literal"><span class="pre">demo/</span></code>, you can observe the voice commands and dictionary. You may want to have a look at their content using <code class="docutils literal"><span class="pre">more</span></code> or <code class="docutils literal"><span class="pre">nano</span></code> text viewers.
Then, run the following command:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch pocketsphinx robocup.launch
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">robocup.dic</span></code> contains the following code:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recognizer&quot;</span> <span class="na">pkg=</span><span class="s">&quot;pocketsphinx&quot;</span> <span class="na">type=</span><span class="s">&quot;recognizer.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lm&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find pocketsphinx)/demo/robocup.lm&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;dict&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find pocketsphinx)/demo/robocup.dic&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>This command will run the <code class="docutils literal"><span class="pre">recognizer.py</span></code> script with loading the dictionary <code class="docutils literal"><span class="pre">robocup.dic</span></code>.
A list of INFO messages will appear showing the loading of the recognition model. The last few messages will look like this:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>INFO: ngram_search_fwdtree.c(186): Creating search tree
INFO: ngram_search_fwdtree.c(191): before: 0 root, 0 non-root channels, 12 single-phone words
INFO: ngram_search_fwdtree.c(326): after: max nonroot chan increased to 328
INFO: ngram_search_fwdtree.c(338): after: 77 root, 200 non-root channels, 11 single-phone words
</pre></div>
</div>
<p>Now, you can start saying some words to check if the recognizer will be able to understand what you are saying. For example, try to say the following words:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">hello</span>
<span class="n">go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">room</span>
<span class="n">my</span> <span class="n">name</span> <span class="ow">is</span>
<span class="n">door</span>
<span class="n">follow</span> <span class="n">room</span>
</pre></div>
</div>
<p>You can also try different words.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It might be possible that the recognizer will detect words different from what you pronounced. This may be due to (1) bad microphone, in this case try to get a high-quality microphone, (2) your pronounciation is not enough clear. In this case, try to repeat the word.</p>
</div>
<p>If the recognizer successfuly detected your spoken word, you can move to the next step to talk to your robot.</p>
<p>The spoken words found by the recognizer will be published to the topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code>. Type</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>rostopic echo /recognizer/output
</pre></div>
</div>
<p>in another terminal to see the results as follows:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>data: go to the room
--
data: hello
--
</pre></div>
</div>
<p>To see all the predefined commands in the RoboCup demo, run the following commands:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">roscd</span> <span class="n">pocketsphinx</span><span class="o">/</span><span class="n">demo</span>
<span class="n">more</span> <span class="n">robocup</span><span class="p">.</span><span class="n">corpus</span>
</pre></div>
</div>
<p>Try saying a word that is not in the list such as &#8220;the food is hot&#8221; and see the results on the topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code>, which will show something different. The recognizer will always try to find the nearest match to the word you say.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you mute the recognizer when not using it because this will send random data to the robot.</p>
</div>
</div>
<div class="section" id="code-and-dependencies">
<h2>Code and dependencies<a class="headerlink" href="#code-and-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The scripts of voice teleoperation can be found in <code class="docutils literal"><span class="pre">gaitech_doc/src/turtlebot/voice_teleop/</span></code> that you imported from GITHUB. Make sure that you imported the code from GITHUB.
If you did not import the code from GITHUB, you can still create a new ROS package as follow:</p>
<blockquote>
<div><ul class="simple">
<li>Go to your catkin workspace and then go to <code class="docutils literal"><span class="pre">~/catkin_ws/src/</span></code></li>
<li>Create new a ROS package called <code class="docutils literal"><span class="pre">gaitech_doc</span></code> (or choose any other name) which depends on <code class="docutils literal"><span class="pre">pocketsphinx</span></code>, <code class="docutils literal"><span class="pre">roscpp</span></code>, <code class="docutils literal"><span class="pre">rospy</span></code>, <code class="docutils literal"><span class="pre">sound_play</span></code> and <code class="docutils literal"><span class="pre">std_msgs</span></code> as follow:</li>
</ul>
<div class="highlight-linux"><div class="highlight"><pre><span></span>catkin_create_pkg gaitech_doc roscpp rospy pocketsphinx sound_play std_msgs
</pre></div>
</div>
<ul class="simple">
<li>In the <code class="docutils literal"><span class="pre">~/catkin_ws/src/</span></code>, write the following command to see all the files and folders created:</li>
</ul>
<div class="highlight-linux"><div class="highlight"><pre><span></span>tree gaitech_doc
</pre></div>
</div>
<ul class="simple">
<li>Now, compile your newly added package:</li>
</ul>
<div class="highlight-linux"><div class="highlight"><pre><span></span>$ cd ~/catkin_ws
~/catkin_ws$ catkin_make
</pre></div>
</div>
<ul class="simple">
<li>Finally, open your <code class="docutils literal"><span class="pre">package.xml</span></code> file and add all the required dependencies (otherwise, your project will not find required packages):</li>
</ul>
</div></blockquote>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Remove the commented parts --&gt;</span>
<span class="nt">&lt;package&gt;</span>
 <span class="nt">&lt;name&gt;</span>gaitech_doc<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
 <span class="nt">&lt;description&gt;</span>gaitech_doc<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;maintainer</span> <span class="na">email=</span><span class="s">&quot;ros@todo.todo&quot;</span><span class="nt">&gt;</span>ros<span class="nt">&lt;/maintainer&gt;</span>
 <span class="nt">&lt;license&gt;</span>TODO<span class="nt">&lt;/license&gt;</span>
 <span class="nt">&lt;buildtool_depend&gt;</span>catkin<span class="nt">&lt;/buildtool_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>pocketsphinx<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>roscpp<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>rospy<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>sound_play<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>std_msgs<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>pocketsphinx<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>roscpp<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>rospy<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>sound_play<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>std_msgs<span class="nt">&lt;/run_depend&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</pre></div>
</div>
<p>Now, you are done with creating the ROS package.</p>
</div>
<div class="section" id="create-your-vocabulary-of-commands">
<h2>Create Your Vocabulary of Commands<a class="headerlink" href="#create-your-vocabulary-of-commands" title="Permalink to this headline">¶</a></h2>
<p>In this section, you will learn how to add a vocabulary or corpus as it is specified in the <code class="docutils literal"><span class="pre">PocketSphinx</span></code>.
In partiuclar, we will create a simple vocabulary of commands to move the turtlebot robot forward, backward, and rotate it left and right.</p>
<p>Create a folder and call it <code class="docutils literal"><span class="pre">config</span></code> and inside this folder create a <code class="docutils literal"><span class="pre">txt</span></code> file called <code class="docutils literal"><span class="pre">motion_commands.txt</span></code>
and put the following commands (which you can extend more later) for the robot motion:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">move</span> <span class="n">forward</span>
<span class="n">move</span> <span class="n">backwards</span>
<span class="n">turn</span> <span class="n">right</span>
<span class="n">turn</span> <span class="n">left</span>
</pre></div>
</div>
<p>Feel free to add/delete/change any command you want as long as you follow the conventions.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Do not use punctuation marks and pay attention to the upper and lower case letters.
If you want to add a number you will have to spell it so you can not write 1, 55, 87..etc instead write one, fifty five, eighty seven.</p>
</div>
<p>After editing the <code class="docutils literal"><span class="pre">motion_commands.txt</span></code> file, you have to compile it into special dictionary and pronounciation files so it matches the specification for the <code class="docutils literal"><span class="pre">PocketSphinx</span></code>.
The online CMU language model (lm) tool is very useful in this case, visit their <a class="reference external" href="http://www.speech.cs.cmu.edu/tools/lmtool-new.html">website</a>  and  upload your file.
Click on the Compile Knowledge Base button, then download the file labeled <code class="docutils literal"><span class="pre">COMPRESSED</span> <span class="pre">TARBALL</span></code> that contains all the language model files
that you need and the <code class="docutils literal"><span class="pre">PocketSphinx</span></code> can understand.</p>
<p>Extract these files into the config subdirectory of the <code class="docutils literal"><span class="pre">gaitech_doc</span></code> package (or your package where you are working this example). These files must be provided as an input parameter to <code class="docutils literal"><span class="pre">recognizer.py</span></code> node.
To do so, you need to create a launch file as follow.</p>
<blockquote>
<div><ul class="simple">
<li>First, create a folder and call it <code class="docutils literal"><span class="pre">launch</span></code> where to create launch files</li>
<li>Then, create a file called <code class="docutils literal"><span class="pre">voice_teleop.launch</span></code>, and add the following XML code:</li>
</ul>
</div></blockquote>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;launch&gt;</span>
     <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recognizer&quot;</span> <span class="na">pkg=</span><span class="s">&quot;pocketsphinx&quot;</span> <span class="na">type=</span><span class="s">&quot;recognizer.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lm&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/turtlebot/voice_teleop/config/motion_commands.lm&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;dict&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/turtlebot/voice_teleop/config/motion_commands.dic&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your package name is different from <code class="docutils literal"><span class="pre">gaitech_doc</span></code> make sure to consider this in the instruction <code class="docutils literal"><span class="pre">value=&quot;$(find</span> <span class="pre">gaitech_doc)</span></code> of the launch file. Otherwise, ROS will not be able to find the parameters
Make sure that you put the correct path for the <code class="docutils literal"><span class="pre">lm</span></code> and <code class="docutils literal"><span class="pre">dic</span></code> files.</p>
</div>
<p>This file runs the <code class="docutils literal"><span class="pre">recognizer.py</span></code> node from the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package mentioned before in this tutorial.
The <code class="docutils literal"><span class="pre">lm</span></code> and <code class="docutils literal"><span class="pre">dict</span></code> parameters are mentioned how are they created and what is their use in the files <code class="docutils literal"><span class="pre">motion_commands.lm</span></code> and <code class="docutils literal"><span class="pre">motion_commands.dic</span></code> created in the previous step.
The last parameter which is <code class="docutils literal"><span class="pre">output=&quot;screen&quot;</span></code> is used to let us see in real-time the recognition results in the launch window.</p>
<p>Launch the <code class="docutils literal"><span class="pre">voice_teleop.launch</span></code> file:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch gaitech_doc voice_teleop.launch
</pre></div>
</div>
<p>and in another terminal run the following command to see the published topics after giving the robot a couple of commands:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>rostopic echo /recognizer/output
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure to close all the running launch files and all the demos running from previous examples before you run the previous commands.</p>
</div>
</div>
<div class="section" id="a-voice-control-navigation-script">
<h2>A Voice-Control Navigation Script<a class="headerlink" href="#a-voice-control-navigation-script" title="Permalink to this headline">¶</a></h2>
<p>As mentioned before the <code class="docutils literal"><span class="pre">recognizer.py</span></code> node in the <cite>pocketsphinx</cite> package publishes a topic called <code class="docutils literal"><span class="pre">/recognizer/output</span></code>. But there must be a file that subscribes to this topic and gives orders to the robot according to the commands given by the user.
The <code class="docutils literal"><span class="pre">voice_nav.py</span></code> file in the <cite>pocketsphinx</cite> package maps the commands into <cite>Twist</cite> messages that can be used to control your turtlebot robot.
You can find this file in the <code class="docutils literal"><span class="pre">turtlebot_cont_movement/nodes</span></code> subdirectory.</p>
</div>
<div class="section" id="code-explanation">
<h2>Code Explanation<a class="headerlink" href="#code-explanation" title="Permalink to this headline">¶</a></h2>
<p>This is the content of the <code class="docutils literal"><span class="pre">voice_nav.py</span></code> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span> <span class="c1">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">RobotVoiceTeleop</span><span class="p">:</span>
    <span class="c1">#define the constructor of the class</span>
    <span class="k">def</span>  <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#initialize the ROS node with a name voice_teleop</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;voice_teleop&#39;</span><span class="p">)</span>

        <span class="c1"># Publish the Twist message to the cmd_vel topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;cmd_vel&#39;</span><span class="p">,</span> <span class="n">Twist</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Subscribe to the /recognizer/output topic to receive voice commands.</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/recognizer/output&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_command_callback</span><span class="p">)</span>

        <span class="c1">#create a Rate object to sleep the process at 5 Hz</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Initialize the Twist message we will publish.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
        <span class="c1">#make sure to make the robot stop by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>



        <span class="c1"># A mapping from keywords or phrases to commands</span>
        <span class="c1">#we consider the following simple commands, which you can extend on your own</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span>             <span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;forward&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;backward&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;rotate left&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;rotate right&#39;</span><span class="p">,</span>
                                    <span class="p">]</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Ready to receive voice commands&quot;</span><span class="p">)</span>
        <span class="c1"># We have to keep publishing the cmd_vel message if we want the robot to keep moving.</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="p">)</span>
            <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">voice_command_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Get the motion command from the recognized phrase</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;rotate left&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;rotate right&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1">#command not found</span>
            <span class="c1">#print &#39;command not found: &#39;+command</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;linear speed : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;angular speed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>



<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">RobotVoiceTeleop</span><span class="p">()</span>
      <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
      <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Voice navigation terminated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now create another launch file called <code class="docutils literal"><span class="pre">turtlebot_voice_teleop.launch</span></code> and its content should be:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
 <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;voice_nav&quot;</span> <span class="na">pkg=</span><span class="s">&quot;turtlebot_cont_movement&quot;</span> <span class="na">type=</span><span class="s">&quot;voice_nav.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;scale_linear&quot;</span> <span class="na">value=</span><span class="s">&quot;0.5&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;scale_angular&quot;</span> <span class="na">value=</span><span class="s">&quot;1.5&quot;</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;max_speed&quot;</span> <span class="na">value=</span><span class="s">&quot;0.3&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;start_speed&quot;</span> <span class="na">value=</span><span class="s">&quot;0.1&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;linear_increment&quot;</span> <span class="na">value=</span><span class="s">&quot;0.05&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;angular_increment&quot;</span> <span class="na">value=</span><span class="s">&quot;0.4&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>This file controls the speed of the robot while moving.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The increment speed parameters will be used when you add a command related to them such as <cite>go faster</cite>, <cite>faster</cite> or <cite>go slower</cite>, <cite>slow</cite></p>
</div>
</div>
<div class="section" id="testing-the-voice-control-in-the-gazebo-and-stage-simulators">
<h2>Testing the Voice-Control in the Gazebo and Stage Simulators<a class="headerlink" href="#testing-the-voice-control-in-the-gazebo-and-stage-simulators" title="Permalink to this headline">¶</a></h2>
<p>This section introduce how to test the voice recognition with the Gazebo and Stage simulators.</p>
<p>Now let&#8217;s bring up <cite>Gazebo</cite>  with the simulation config file:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_gazebo turtlebot_world.launch
</pre></div>
</div>
<p>OR</p>
<p>Bring up <cite>Stage</cite>  simulator using the following command:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_stage turtlebot_in_stage_no_rviz.launch
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These simulators requires a powerful PC with a good graphics card that can launch them. They also may crash once you start them but don&#8217;t worry this is very normal, just rerun the script until it launches.</p>
</div>
<p>To able to view the commands that are recognizable by the robot we have to run the <code class="docutils literal"><span class="pre">rqt_console</span></code> using the following command:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>rqt_console &amp;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure to check your Mic settings as discribed before.</p>
</div>
<p>Run the <code class="docutils literal"><span class="pre">cont_movement.launch</span></code> file which runs the <code class="docutils literal"><span class="pre">voice_nav.py</span></code> file:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_cont_movement cont_movement.launch
</pre></div>
</div>
<p>The following command is responsible for controlling the speed of the robot:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_cont_movement turtlebot_voice_cont_movement.launch
</pre></div>
</div>
<p>Now test your robot by giving it any command from the list mentiond previously.</p>
</div>
<div class="section" id="testing-the-voice-control-with-a-turtlebot-robot">
<h2>Testing the Voice-Control with a Turtlebot Robot<a class="headerlink" href="#testing-the-voice-control-with-a-turtlebot-robot" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before you test the robot make sure that your robot is in an open space with no obstacles or edges next to it.</p>
</div>
<p>From the ROS Master node(the Turtlebot&#8217;s laptop) run the following commands:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch rbx1_bringup turtlebot_minimal_create.launch
</pre></div>
</div>
<p>To make the monitoring process easier bring up <cite>rqt_console</cite> by running:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>rqt_console &amp;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check your sound settings as mentioned before.</p>
</div>
<p>On the host node(the user PC) run the <code class="docutils literal"><span class="pre">cont_movement.launch</span></code> file:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_cont_movement cont_movement.launch
</pre></div>
</div>
<p>and in another terminal run the following command:</p>
<div class="highlight-linux"><div class="highlight"><pre><span></span>roslaunch turtlebot_cont_movement turtlebot_voice_cont_movement.launch
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Try a simple command at first like the rotate right to avoid any accidents. You can change the robot&#8217;s speed by giving the command &#8220;go faster&#8221; or &#8220;slow down&#8221; and this will change the parameters for speed in the turtlebot_voice_nav.launch file. However, you will have to add the commands as mentioned previously in the <cite>config/cont_movement.txt</cite> file and redo all he steps again.</p>
</div>
<p>##import: speech-video in this location</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="send-goals-nav-stack.html" class="btn btn-neutral float-right" title="Sending Goals to the Navigation Stack" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="turtlebot-first-tests.html" class="btn btn-neutral" title="Turtlebot First Tests" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gaitech.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>