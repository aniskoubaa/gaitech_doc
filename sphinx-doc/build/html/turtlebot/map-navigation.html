

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Map-Based Navigation &mdash; Gaitech EDU 2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/gaitech32.jpg"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Gaitech EDU 2.5 documentation" href="../index.html"/>
        <link rel="up" title="Turtlebot Quick Start Tutorials" href="turtlebot-tutorials.html"/>
        <link rel="next" title="Turtlebot Free Space Navigation" href="free-space-navigation.html"/>
        <link rel="prev" title="Building a Map with a Turtlebot" href="create-map-kenict.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Gaitech EDU
          

          
            
            <img src="../_static/gaitechlogo150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/ros-tutorials.html">ROS Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roslink/index.html">ROSLink</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="turtlebot-tutorials.html">Turtlebot Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="turtlebot-first-tests.html">First Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-config-doc.html">Network Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="teleop-doc.html">Keyboard Teleop</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-simulators.html">Turtlebot Simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="speech-doc.html">Voice Teleoperation</a></li>
<li class="toctree-l2"><a class="reference internal" href="openKinect-turtlebot.html">Setting-up 3D Sensor for the Turtlebot</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-map-kenict.html">Building a Map with a Turtlebot</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Map Navigation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-files">Tutorial Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finding-the-coordinates-for-locations-of-interest">Finding the Coordinates for Locations of Interest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-the-navigation-program">Writing the navigation program</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#playing-sounds">Playing sounds</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing-the-code">Testing the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-your-own-map-on-simulation-and-real-robot">Testing with Your Own Map on Simulation and Real Robot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-on-a-real-robot">Running on a real robot</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-questions-and-activity">Review Questions and Activity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="free-space-navigation.html">Turtlebot free movement in Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-pincher.html">Turtlebot Arm PhantomX Pincher with ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="turtlebot-arm-arduino.html">Controlling a Turtlebot Arm with an Arduino Board using RFID</a></li>
<li class="toctree-l2"><a class="reference internal" href="hokuyo-turtlebot.html">Adding Hokuyo Laser Range Finder to Turtlebot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../drones/index.html">Drones Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gapter/index.html">Gapter Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../video/index.html">Video Streaming Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors/index.html">Contributors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gaitech EDU</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="turtlebot-tutorials.html">Turtlebot Quick Start Tutorials</a> &raquo;</li>
      
    <li>Map-Based Navigation</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/turtlebot/map-navigation.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="map-based-navigation">
<span id="send-goals-nav-stack"></span><h1>Map-Based Navigation<a class="headerlink" href="#map-based-navigation" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you will learn about map-based navigation in ROS. You will be able to develop a ROS program in C++ and Python that will allow you to define goal locations for the robot and then send these goal locations to the navigation stack to execute the mission and head towards the goal.
Note that it is possible to do so with rviz, but in this tutorial, you will be able to do this programmatically.
You will also learn how to configure <code class="docutils literal"><span class="pre">ros</span> <span class="pre">stage</span></code> simulation to use a map of your choice and perform a navigation mission in the select map.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>At the end of this tutorial, you will be able to:</p>
<ul class="last simple">
<li>Understand how map-based navigation is performed in ROS.</li>
<li>Develop a ROS program that defines goal locations programmatically and send them to the navigation stack</li>
<li>Configure the ROS <code class="docutils literal"><span class="pre">stage</span></code> Turtlebot simulator to  use a particular map of interest</li>
<li>Use <code class="docutils literal"><span class="pre">sound_play</span></code> ROS package to play sound in a ROS application.</li>
</ul>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>The objective of this tutorial is to use a map of interest and request the robot to go to certain locations on that map.
In the previous tutorial <a class="reference internal" href="create-map-kenict.html#create-map"><span class="std std-ref">Building a Map with a Turtlebot</span></a>, you already learned how to build a map with the Turtlebot. You will learn how to use such a map to program navigation missions for the robot.
Remember that a map in ROS consists of two files, namely a <code class="docutils literal"><span class="pre">.yaml</span></code> file that contains information about the map, and a <code class="docutils literal"><span class="pre">.pgm</span></code> file that contains the map itself.
In this tutorial, we are going to consider the following University floor map to develop our navigation example</p>
<div class="figure align-center">
<img alt="../_images/psu.png" src="../_images/psu.png" />
</div>
<p><strong>Figure 1. University Floor Map</strong></p>
<p>Later on, as an exercise, you will use your own map to develop a navigation mission for your Turtlebot.</p>
<p>In the map of Figure 1, we identify four locations of interests namely, the Cafe area, Office1, Office2 and Office3. Other locations can also be defined, but we just used these representative four locations for illustration purposes.
If we want to develop a ROS program that allow the robot to navigate to those locations, we first need to know what are the <code class="docutils literal"><span class="pre">(x,y)</span></code> coordinate of these locations onto the map. This is what will be explained later.
Then, we use these coordinates to define a navigation mission that we submit to the robot&#8217;s navigation stack to execute it.
Remember that any robot on ROS runs the <code class="docutils literal"><span class="pre">move_base</span></code> navigation stack which allow the robot to find a path towards a goal and execute the path following while avoiding obstacles. Refer to <a class="reference internal" href="navigation-stack.html#navigation-stack"><span class="std std-ref">Navigation Stack Review</span></a> for a refresher.</p>
</div>
<div class="section" id="tutorial-files">
<h2>Tutorial Files<a class="headerlink" href="#tutorial-files" title="Permalink to this headline">¶</a></h2>
<p>You can find the whole <code class="docutils literal"><span class="pre">cpp</span></code> and <code class="docutils literal"><span class="pre">python</span></code> files in our <a class="reference external" href="https://github.com/aniskoubaa/gaitech_edu">GitHub repository</a>.
They are located in <code class="docutils literal"><span class="pre">src/turtlebot/navigation/map_navigation</span></code> folder.
In particular, we will use the launch file <code class="docutils literal"><span class="pre">map_navigation_psu.launch</span></code> that contains all the needed ROS nodes for this tutorial.
Here is the content of the <code class="docutils literal"><span class="pre">map_navigation_psu.launch</span></code> file.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
      <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find gaitech_edu)/src/turtlebot/navigation/map_navigation/launch/turtlebot_stage_psu.launch&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;map_navigation&quot;</span> <span class="na">pkg=</span><span class="s">&quot;gaitech_edu&quot;</span> <span class="na">type=</span><span class="s">&quot;map_navigation_node&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/node&gt;</span>
     <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;playing_sound_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;sound_play&quot;</span> <span class="na">type=</span><span class="s">&quot;soundplay_node.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>We observe that there are three nodes:</p>
<blockquote>
<div><ul class="simple">
<li>The first one includes the <code class="docutils literal"><span class="pre">turtlebot_stage_psu.launch</span></code> file, which starts-up the Turtlebot simulated robots in the stage simulator. This file initialize several parameters related to the inital position of the robot and the maps that will be used. Here is a partial snapshot of this file:</li>
</ul>
</div></blockquote>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;base&quot;</span>       <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_BASE kobuki)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- create, rhoomba --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;stacks&quot;</span>     <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_STACKS hexagons)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- circles, hexagons --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;3d_sensor&quot;</span>  <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_3D_SENSOR kinect)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- kinect, asus_xtion_pro --&gt;</span>

  <span class="c">&lt;!-- Name of the map to use (without path nor extension) and initial position --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;map_file&quot;</span>       <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/psu.yaml&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- psu --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;world_file&quot;</span>     <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/stage/psu.world&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_x&quot;</span> <span class="na">default=</span><span class="s">&quot;20.925&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_y&quot;</span> <span class="na">default=</span><span class="s">&quot;11.925&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_a&quot;</span> <span class="na">default=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
   ...
   ...
</pre></div>
</div>
<p>You can observe that this launch files defines the <code class="docutils literal"><span class="pre">map_file</span></code>, that is the <code class="docutils literal"><span class="pre">yaml</span></code> file that defines the map that will be used by the navigation stack, and displayed by <code class="docutils literal"><span class="pre">rviz</span></code>.
In addition, it defines the <code class="docutils literal"><span class="pre">world_file</span></code> that is <code class="docutils literal"><span class="pre">world</span></code> file that defines also a map used by the <code class="docutils literal"><span class="pre">stage</span></code> simulator.
Furthermore, <code class="docutils literal"><span class="pre">initial_pose_x</span></code> and <code class="docutils literal"><span class="pre">initial_pose_y</span></code> define the initial location of the robot in terms of x-coordinate and y-coordinate respectively.
How to determine this initale location and locations of interest will be described in details in the next section of this tutorial.</p>
<blockquote>
<div><ul class="simple">
<li>The second node if the <code class="docutils literal"><span class="pre">map_navigation_node</span></code> that is the ROS program that we are going to develop to make the robot travel to  certain location of interest. The program is developed in the file <code class="docutils literal"><span class="pre">map_navigation.cpp</span></code> in C++ and <code class="docutils literal"><span class="pre">map_navigation.py</span></code> in python</li>
<li>the third node, is optional, and represent the <code class="docutils literal"><span class="pre">sound_play</span></code> node that allow to make sound notification in a ROS program.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="finding-the-coordinates-for-locations-of-interest">
<span id="find-locations"></span><h2>Finding the Coordinates for Locations of Interest<a class="headerlink" href="#finding-the-coordinates-for-locations-of-interest" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need to do is to find the location of the locations where you want the robot to go.
These locations depends on the map size and resolutions.
The easiest way to do so is to use <code class="docutils literal"><span class="pre">rviz</span></code> to visualize the map and then getting the coordinate using the <code class="docutils literal"><span class="pre">2D</span> <span class="pre">Pose</span> <span class="pre">Estimate</span></code> button.
Let us start the Turtlebot simulator with the University floor map as follow:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_edu map_navigation_stage_psu.launch
</pre></div>
</div>
<p>The simulator will open. Try to arrange the <code class="docutils literal"><span class="pre">stage</span></code> simulation, <code class="docutils literal"><span class="pre">rviz</span></code> and the command terminal as in the following picture for better visibility:</p>
<div class="figure align-center">
<img alt="../_images/turtlebot-simulation.png" src="../_images/turtlebot-simulation.png" />
</div>
<p><strong>Figure 2: Turtlebot Simulation Environment</strong></p>
<p>Now, you want to find the coordinate of any location of interest. open another terminal and write</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rostopic <span class="nb">echo</span> /amcl_pose
</pre></div>
</div>
<p>This command will display any new <code class="docutils literal"><span class="pre">/amcl_pose</span></code>, which is the ROS topic represents the location of the robot on the map.
Now, click on <code class="docutils literal"><span class="pre">2D</span> <span class="pre">Pose</span> <span class="pre">Estimate</span></code> button, then click on any location of interest on the map.
Go back to the terminal where wrote <code class="docutils literal"><span class="pre">rostopic</span> <span class="pre">echo</span> <span class="pre">/amcl_pose</span></code>, and you will find the coordinate of the point select as in the following figure:</p>
<div class="figure align-center">
<img alt="../_images/show-location.png" src="../_images/show-location.png" />
</div>
<p><strong>Figure 3: Finding the Location of Interest</strong></p>
<p>Take note of the <code class="docutils literal"><span class="pre">(x,y)</span></code> coordinates for the Cafe and the three offices. They should be close to these values:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">Cafe</span> <span class="p">(</span><span class="mf">15.50</span><span class="p">,</span> <span class="mf">10.20</span><span class="p">)</span>
<span class="n">Office1</span> <span class="p">(</span><span class="mf">27.70</span><span class="p">,</span><span class="mf">12.50</span><span class="p">)</span>
<span class="n">Office2</span> <span class="p">(</span><span class="mf">30.44</span><span class="p">,</span><span class="mf">12.50</span><span class="p">)</span>
<span class="n">Office3</span> <span class="p">(</span><span class="mf">35.20</span><span class="p">,</span><span class="mf">12.50</span><span class="p">)</span>
</pre></div>
</div>
<p>The following video demonstrates the whole process.</p>
<iframe width="640" height="360" src="http://www.youtube.com/embed/sWFDk1BxsyA" frameborder="0" allowfullscreen="1">&nbsp;</iframe></div>
<div class="section" id="writing-the-navigation-program">
<h2>Writing the navigation program<a class="headerlink" href="#writing-the-navigation-program" title="Permalink to this headline">¶</a></h2>
<p>Now, we are ready to write a program that allows the robot to navigate to the goal location.
Here is the snapshot of the code in C++:</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;move_base_msgs/MoveBaseAction.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;actionlib/client/simple_action_client.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;sound_play/sound_play.h&quot;</span><span class="cp"></span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">path_to_sounds</span><span class="p">;</span>

<span class="cm">/** function declarations **/</span>
<span class="kt">bool</span> <span class="nf">moveToGoal</span><span class="p">(</span><span class="kt">double</span> <span class="n">xGoal</span><span class="p">,</span> <span class="kt">double</span> <span class="n">yGoal</span><span class="p">);</span>
<span class="kt">char</span> <span class="nf">choose</span><span class="p">();</span>

<span class="cm">/** declare the coordinates of interest **/</span>
<span class="kt">double</span> <span class="n">xCafe</span> <span class="o">=</span> <span class="mf">15.50</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">yCafe</span> <span class="o">=</span> <span class="mf">10.20</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">xOffice1</span> <span class="o">=</span> <span class="mf">27.70</span> <span class="p">;</span>
<span class="kt">double</span> <span class="n">yOffice1</span> <span class="o">=</span> <span class="mf">12.50</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">xOffice2</span> <span class="o">=</span> <span class="mf">30.44</span> <span class="p">;</span>
<span class="kt">double</span> <span class="n">yOffice2</span> <span class="o">=</span> <span class="mf">12.50</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">xOffice3</span> <span class="o">=</span> <span class="mf">35.20</span> <span class="p">;</span>
<span class="kt">double</span> <span class="n">yOffice3</span> <span class="o">=</span> <span class="mf">13.50</span><span class="p">;</span>

<span class="kt">bool</span> <span class="n">goalReached</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
 <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">){</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">&quot;map_navigation_node&quot;</span><span class="p">);</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">n</span><span class="p">;</span>
   <span class="n">sound_play</span><span class="o">::</span><span class="n">SoundClient</span> <span class="n">sc</span><span class="p">;</span>
   <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
   <span class="n">path_to_sounds</span> <span class="o">=</span> <span class="s">&quot;/home/ros/catkin_ws/src/gaitech_edu/src/sounds/&quot;</span><span class="p">;</span>

   <span class="kt">char</span> <span class="n">choice</span> <span class="o">=</span> <span class="sc">&#39;q&#39;</span><span class="p">;</span>
   <span class="k">do</span><span class="p">{</span>
      <span class="n">choice</span> <span class="o">=</span><span class="n">choose</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span><span class="p">){</span>
         <span class="n">goalReached</span> <span class="o">=</span> <span class="n">moveToGoal</span><span class="p">(</span><span class="n">xCafe</span><span class="p">,</span> <span class="n">yCafe</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span><span class="p">){</span>
         <span class="n">goalReached</span> <span class="o">=</span> <span class="n">moveToGoal</span><span class="p">(</span><span class="n">xOffice1</span><span class="p">,</span> <span class="n">yOffice1</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="sc">&#39;2&#39;</span><span class="p">){</span>
         <span class="n">goalReached</span> <span class="o">=</span> <span class="n">moveToGoal</span><span class="p">(</span><span class="n">xOffice2</span><span class="p">,</span> <span class="n">yOffice2</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="sc">&#39;3&#39;</span><span class="p">){</span>
         <span class="n">goalReached</span> <span class="o">=</span> <span class="n">moveToGoal</span><span class="p">(</span><span class="n">xOffice3</span><span class="p">,</span> <span class="n">yOffice3</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">choice</span><span class="o">!=</span><span class="sc">&#39;q&#39;</span><span class="p">){</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">goalReached</span><span class="p">){</span>
            <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Congratulations!&quot;</span><span class="p">);</span>
            <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
            <span class="n">sc</span><span class="p">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s">&quot;ship_bell.wav&quot;</span><span class="p">);</span>
            <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>

         <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Hard Luck!&quot;</span><span class="p">);</span>
            <span class="n">sc</span><span class="p">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s">&quot;short_buzzer.wav&quot;</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">choice</span> <span class="o">!=</span><span class="sc">&#39;q&#39;</span><span class="p">);</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The program structure is very simple.
The user is requested to press a key, and based on his selection, the defined method <code class="docutils literal"><span class="pre">moveToGoal(x,y)</span></code> will be executed,
where <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> define the coordinates of the locations of interest.
Lines 13-20 define the location of points of interest that we determined in the last section <a class="reference internal" href="#find-locations"><span class="std std-ref">Finding the Coordinates for Locations of Interest</span></a>.
Then, from lines 42-51, if the goal is successully reached, the program will display <code class="docutils literal"><span class="pre">congratulations</span></code> text message and will plan a <code class="docutils literal"><span class="pre">ship_bell</span></code> sound.
Otherwise, it will display <code class="docutils literal"><span class="pre">hard</span> <span class="pre">luck</span></code> message and will play the <code class="docutils literal"><span class="pre">short</span> <span class="pre">buzzer</span></code> sound.</p>
<p>Now, let us focus more on how the method  <code class="docutils literal"><span class="pre">moveToGoal(x,y)</span></code> is implemented. Here is the code.</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">moveToGoal</span><span class="p">(</span><span class="kt">double</span> <span class="n">xGoal</span><span class="p">,</span> <span class="kt">double</span> <span class="n">yGoal</span><span class="p">){</span>

   <span class="c1">//define a client for to send goal requests to the move_base server through a SimpleActionClient</span>
   <span class="n">actionlib</span><span class="o">::</span><span class="n">SimpleActionClient</span><span class="o">&lt;</span><span class="n">move_base_msgs</span><span class="o">::</span><span class="n">MoveBaseAction</span><span class="o">&gt;</span> <span class="n">ac</span><span class="p">(</span><span class="s">&quot;move_base&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

   <span class="c1">//wait for the action server to come up</span>
   <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ac</span><span class="p">.</span><span class="n">waitForServer</span><span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">Duration</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))){</span>
      <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Waiting for the move_base action server to come up&quot;</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">move_base_msgs</span><span class="o">::</span><span class="n">MoveBaseGoal</span> <span class="n">goal</span><span class="p">;</span>

   <span class="c1">//set up the frame parameters</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">&quot;map&quot;</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

   <span class="cm">/* moving towards the goal*/</span>

   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span>  <span class="n">xGoal</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span>  <span class="n">yGoal</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

   <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;Sending goal location ...&quot;</span><span class="p">);</span>
   <span class="n">ac</span><span class="p">.</span><span class="n">sendGoal</span><span class="p">(</span><span class="n">goal</span><span class="p">);</span>

   <span class="n">ac</span><span class="p">.</span><span class="n">waitForResult</span><span class="p">();</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ac</span><span class="p">.</span><span class="n">getState</span><span class="p">()</span> <span class="o">==</span> <span class="n">actionlib</span><span class="o">::</span><span class="n">SimpleClientGoalState</span><span class="o">::</span><span class="n">SUCCEEDED</span><span class="p">){</span>
      <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;You have reached the destination&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">else</span><span class="p">{</span>
      <span class="n">ROS_INFO</span><span class="p">(</span><span class="s">&quot;The robot failed to reach the destination&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Line 4 defines a client that is responsible for sending navigation goal request to the <code class="docutils literal"><span class="pre">move_base</span></code> server.
In fact, the navigation stack of ROS has a <code class="docutils literal"><span class="pre">MoveBaseAction</span></code> action server  that receives navigation goals request,
and then finds a global path from the robot location to the goal location through the <code class="docutils literal"><span class="pre">Global</span> <span class="pre">Path</span> <span class="pre">Planner</span></code>,
and once a path is found, it executes the path while avoiding obstacle through the <code class="docutils literal"><span class="pre">Local</span> <span class="pre">Path</span> <span class="pre">Planner</span></code> until it reaches the destination or fails to do so for any reason (like unexpected obstacle found on path).</p>
<p>Lines 7-8 will wait until it finds the action server and will not proceed longer until it makes sure that it is alive and will receive navigation requests.
This is in fact a blocking instruction.</p>
<p>Line 11 defines a goal location and lines 13-25 specify the parameters of that location.
It is easy to understand that lines 19-25 define the coordinates for the goal location.
In particular the orientation component values expressed in <a class="reference external" href="https://en.wikipedia.org/wiki/Quaternion">quaternion</a> refers to a heading equal to zero degrees.</p>
<p>Lines 14-15 are extremely important, in particular line 14.
Line 14  <code class="docutils literal"><span class="pre">goal.target_pose.header.frame_id</span> <span class="pre">=</span> <span class="pre">&quot;map&quot;</span></code> specifies the reference frame for that location. In this example, it is specified as the <code class="docutils literal"><span class="pre">map</span></code> frame, which simply means that the coordinates will be considered in the global reference frame related to the map itself.
In other words, it is the <strong>absolute position</strong> on the map.
In case where the reference frame is set with respect to the robot, namely <code class="docutils literal"><span class="pre">goal.target_pose.header.frame_id</span> <span class="pre">=</span> <span class="pre">&quot;base_link&quot;</span></code>  (like in <a class="reference external" href="http://wiki.ros.org/navigation/Tutorials/SendingSimpleGoals">this tutorial</a>), the coordinate will have a completely other meaning.
In fact, in this case the coordinate will represent the <code class="docutils literal"><span class="pre">(x,y)</span></code> coordinate with respect to robot base frame attached to the robot, so it is a <strong>relative position</strong> rather than a <strong>absolute position</strong> as in the case of using the <code class="docutils literal"><span class="pre">map</span></code> frame.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For example, if we consider the following piece of code for the goal location (changes are highlighted):</p>
<div class="highlight-c"><div class="highlight"><pre><span></span>   <span class="n">move_base_msgs</span><span class="o">::</span><span class="n">MoveBaseGoal</span> <span class="n">goal</span><span class="p">;</span>

   <span class="c1">//set up the frame parameters</span>
<span class="hll">   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">&quot;base_link&quot;</span><span class="p">;</span> <span class="c1">//or &quot;base_footprint&quot;</span>
</span>   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>

   <span class="cm">/* moving towards the goal*/</span>
<span class="hll">   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span>  <span class="mf">1.0</span><span class="p">;</span>
</span><span class="hll">   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
</span>   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
   <span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</pre></div>
</div>
<p class="last">In this case, goal location refers to the position that is one meter ahead of the robot (in front of the robot), so by executing this goal location, the robot will just move 1 meter in straight line.
This is because the goal location is one meter in the x-axis (that is the front of the robot) with respect to the <code class="docutils literal"><span class="pre">base_link</span></code> frame attached to the robot.</p>
</div>
<p>Line 15 adds a timestamp to the goal location.</p>
<p>Line 28 sends the goal location request to the <code class="docutils literal"><span class="pre">move_base</span></code> action server, and wait for its execution as shown in line 31 (<code class="docutils literal"><span class="pre">ac.waitForResult()</span></code>).
Note that this request is <strong>sychrounous</strong>, which means it will block until the result is sent back to the requesting client object. After it finishes, we can check if the goal succeded or failed and output a message to the user accordingly.</p>
<p>In what follow, we present the equivalent code in Python, which does exactly the same thing:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">linenos</span><span class="p">:</span>

<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">actionlib</span>
<span class="kn">from</span> <span class="nn">move_base_msgs.msg</span> <span class="kn">import</span> <span class="n">MoveBaseAction</span><span class="p">,</span> <span class="n">MoveBaseGoal</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span><span class="p">,</span> <span class="n">degrees</span>
<span class="kn">from</span> <span class="nn">actionlib_msgs.msg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="nn">sound_play.libsoundplay</span> <span class="kn">import</span> <span class="n">SoundClient</span>

<span class="k">class</span> <span class="nc">map_navigation</span><span class="p">():</span>

  <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">choice</span><span class="o">=</span><span class="s1">&#39;q&#39;</span>

    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|-------------------------------|&quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|PRESSE A KEY:&quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|&#39;0&#39;: Cafe &quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|&#39;1&#39;: Office 1 &quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|&#39;2&#39;: Office 2 &quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|&#39;3&#39;: Office 3 &quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|&#39;q&#39;: Quit &quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|-------------------------------|&quot;</span><span class="p">)</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;|WHERE TO GO?&quot;</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">choice</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">sc</span> <span class="o">=</span> <span class="n">SoundClient</span><span class="p">()</span>
    <span class="n">path_to_sounds</span> <span class="o">=</span> <span class="s2">&quot;/home/ros/catkin_ws/src/gaitech_edu/src/sounds/&quot;</span>

    <span class="c1"># declare the coordinates of interest</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xCafe</span> <span class="o">=</span> <span class="mf">15.50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yCafe</span> <span class="o">=</span> <span class="mf">10.20</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xOffice1</span> <span class="o">=</span> <span class="mf">27.70</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yOffice1</span> <span class="o">=</span> <span class="mf">12.50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xOffice2</span> <span class="o">=</span> <span class="mf">30.44</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yOffice2</span> <span class="o">=</span> <span class="mf">12.50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xOffice3</span> <span class="o">=</span> <span class="mf">35.20</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yOffice3</span> <span class="o">=</span> <span class="mf">13.50</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c1"># initiliaze</span>
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;map_navigation&#39;</span><span class="p">,</span> <span class="n">anonymous</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xCafe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yCafe</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice2</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice3</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">choice</span><span class="o">!=</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>

      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span><span class="p">):</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Congratulations!&quot;</span><span class="p">)</span>
        <span class="c1">#rospy.spin()</span>

        <span class="n">sc</span><span class="o">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s2">&quot;ship_bell.wav&quot;</span><span class="p">)</span>


       <span class="k">else</span><span class="p">:</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Hard Luck!&quot;</span><span class="p">)</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s2">&quot;short_buzzer.wav&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">choice</span> <span class="o">!=</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
      <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choose</span><span class="p">()</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xCafe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yCafe</span><span class="p">)</span>

      <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice1</span><span class="p">)</span>

      <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice2</span><span class="p">)</span>

      <span class="k">elif</span> <span class="p">(</span><span class="n">choice</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xOffice3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yOffice3</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">choice</span><span class="o">!=</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goalReached</span><span class="p">):</span>
          <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Congratulations!&quot;</span><span class="p">)</span>
          <span class="c1">#rospy.spin()</span>

          <span class="n">sc</span><span class="o">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s2">&quot;ship_bell.wav&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Hard Luck!&quot;</span><span class="p">)</span>
          <span class="n">sc</span><span class="o">.</span><span class="n">playWave</span><span class="p">(</span><span class="n">path_to_sounds</span><span class="o">+</span><span class="s2">&quot;short_buzzer.wav&quot;</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># stop turtlebot</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Quit program&quot;</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">moveToGoal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xGoal</span><span class="p">,</span><span class="n">yGoal</span><span class="p">):</span>

      <span class="c1">#define a client for to send goal requests to the move_base server through a SimpleActionClient</span>
      <span class="n">ac</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s2">&quot;move_base&quot;</span><span class="p">,</span> <span class="n">MoveBaseAction</span><span class="p">)</span>

      <span class="c1">#wait for the action server to come up</span>
      <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">ac</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="o">.</span><span class="n">from_sec</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))):</span>
              <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Waiting for the move_base action server to come up&quot;</span><span class="p">)</span>


      <span class="n">goal</span> <span class="o">=</span> <span class="n">MoveBaseGoal</span><span class="p">()</span>

      <span class="c1">#set up the frame parameters</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

      <span class="c1"># moving towards the goal*/</span>

      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span>  <span class="n">Point</span><span class="p">(</span><span class="n">xGoal</span><span class="p">,</span><span class="n">yGoal</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
      <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span>

      <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Sending goal location ...&quot;</span><span class="p">)</span>
      <span class="n">ac</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>

      <span class="n">ac</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>

      <span class="k">if</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span>  <span class="n">GoalStatus</span><span class="o">.</span><span class="n">SUCCEEDED</span><span class="p">):</span>
              <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;You have reached the destination&quot;</span><span class="p">)</span>
              <span class="k">return</span> <span class="bp">True</span>

      <span class="k">else</span><span class="p">:</span>
              <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;The robot failed to reach the destination&quot;</span><span class="p">)</span>
              <span class="k">return</span> <span class="bp">False</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;You have reached the destination&quot;</span><span class="p">)</span>
        <span class="n">map_navigation</span><span class="p">()</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>

    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;map_navigation node terminated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="playing-sounds">
<h3>Playing sounds<a class="headerlink" href="#playing-sounds" title="Permalink to this headline">¶</a></h3>
<p>To add some animation to this example, we used the ROS package <code class="docutils literal"><span class="pre">sound_play</span></code> which allows to play sound files.
Observe that we included the C library for the sound plan in line 4 of the first code above.
Furthermore, to be able to play sounds, it is necessary to start the ROS node, which was already done in the <code class="docutils literal"><span class="pre">map_navigation_psu.launch</span></code>. Without this node, no sound can be played.</p>
<p>In the program, we create a sound client with <code class="docutils literal"><span class="pre">sound_play::SoundClient</span> <span class="pre">sc;</span></code> and also we defined the absolute path to sound files with <code class="docutils literal"><span class="pre">path_to_sounds</span> <span class="pre">=</span> <span class="pre">&quot;/home/ros/catkin_ws/src/gaitech_edu/src/sounds/&quot;</span></code>.</p>
<p>Then, we use the method <code class="docutils literal"><span class="pre">sc.playWave(path_to_the_sound_file)</span></code> to play a certain sound file. For example, in case of successul mission, the sound is played with <code class="docutils literal"><span class="pre">sc.playWave(path_to_sounds+&quot;ship_bell.wav&quot;);</span></code>.</p>
</div>
</div>
<div class="section" id="testing-the-code">
<h2>Testing the code<a class="headerlink" href="#testing-the-code" title="Permalink to this headline">¶</a></h2>
<p>To test the above example, you simply need to execute the command</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_edu map_navigation_stage_psu.launch
</pre></div>
</div>
<p>Then, on the terminal command, you enter the location of your choice based on the selection menu and observe how the robot navigates to the goal location.</p>
<p>OR</p>
<p>You can run the nodes separately as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_edu turtlebot_stage_psu.launch
rosrun sound_play soundplay_node.py
</pre></div>
</div>
<p>Then for <code class="docutils literal"><span class="pre">C++</span></code> run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun gaitech_edu map_navigation_node
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">Python</span></code> run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python your_path/gaitech_edu/src/turtlebot/navigation/map_navigation/scripts/map_navigation.py
</pre></div>
</div>
<p>Congratulation! You now know how to program navigation mission for your simulated Turtlebot.</p>
<p>For a live explanation and testing of the code, watch the following video</p>
<iframe width="640" height="360" src="http://www.youtube.com/embed/r5kK9pIOcNQ" frameborder="0" allowfullscreen="1">&nbsp;</iframe></div>
<div class="section" id="testing-with-your-own-map-on-simulation-and-real-robot">
<h2>Testing with Your Own Map on Simulation and Real Robot<a class="headerlink" href="#testing-with-your-own-map-on-simulation-and-real-robot" title="Permalink to this headline">¶</a></h2>
<p>It is easy to apply the navigation code on a real robot.
However, you should deploy it using the map of the environment where you are going to run the experiments.</p>
<p>First, using the instructions of the <a class="reference internal" href="create-map-kenict.html#create-map"><span class="std std-ref">Building a Map with a Turtlebot</span></a> tutorial, create the map of your experimental environment.</p>
<p>Now, you need to make changes to the launch and world files to consider the information of the map of your environment. Follow these steps:</p>
<blockquote>
<div><ul class="simple">
<li>Step 1. Put the  <code class="docutils literal"><span class="pre">.yaml</span></code> and <code class="docutils literal"><span class="pre">.pgm</span></code>  map files in the <code class="docutils literal"><span class="pre">src/maps/</span></code> folder. Let us assume they are called <code class="docutils literal"><span class="pre">mymap.yaml</span></code> and <code class="docutils literal"><span class="pre">myamap.pgm</span></code>.</li>
<li>Step 2. In the <code class="docutils literal"><span class="pre">src/turtlebot/navigation/map_navigation/launch/</span></code> folder, make a copy of the two files <code class="docutils literal"><span class="pre">map_navigation_stage_psu.launch</span></code> and <code class="docutils literal"><span class="pre">turtlebot_stage_psu.launch</span></code> and give them other names, for example <code class="docutils literal"><span class="pre">map_navigation_maymap.launch</span></code> and <code class="docutils literal"><span class="pre">turtlebot_stage_mymap.launch</span></code>. We will use these two files to launch the simulator with your own map.</li>
<li>Step 3. In the new file, <code class="docutils literal"><span class="pre">map_navigation_maymap.launch</span></code>, change <code class="docutils literal"><span class="pre">turtlebot_stage_psu.launch</span></code> with <code class="docutils literal"><span class="pre">turtlebot_stage_mymap.launch</span></code>. This mean you will start the Turtlebot simulator with the parameters of your map. For this, you need to make the following changes to the  <code class="docutils literal"><span class="pre">turtlebot_stage_mymap.launch</span></code></li>
<li>Step 4. Change the name of the map and world files in <code class="docutils literal"><span class="pre">turtlebot_stage_mymap.launch</span></code> file as follow:</li>
</ul>
</div></blockquote>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;base&quot;</span>       <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_BASE kobuki)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- create, rhoomba --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;stacks&quot;</span>     <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_STACKS hexagons)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- circles, hexagons --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;3d_sensor&quot;</span>  <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_3D_SENSOR kinect)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- kinect, asus_xtion_pro --&gt;</span>

  <span class="c">&lt;!-- Name of the map to use (without path nor extension) and initial position --&gt;</span>
<span class="hll">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;map_file&quot;</span>       <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/mymap.yaml&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- psu --&gt;</span>
</span><span class="hll">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;world_file&quot;</span>     <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/stage/mymap.world&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">  .....
</span></pre></div>
</td></tr></table></div>
<ul class="simple">
<li>Step 5. Now, you need to edit the file <code class="docutils literal"><span class="pre">mymap.world</span></code> file. This file is used by <code class="docutils literal"><span class="pre">stage</span></code> to display the map. In the folder, <code class="docutils literal"><span class="pre">src/maps/stage/</span></code>, Make a copy of <code class="docutils literal"><span class="pre">psu.world</span></code>, change its name to <code class="docutils literal"><span class="pre">mymap.world</span></code> and open it with <code class="docutils literal"><span class="pre">gedit</span></code>.</li>
</ul>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">floorplan</span>
<span class="l l-Scalar l-Scalar-Plain">(</span>
<span class="hll">  <span class="l l-Scalar l-Scalar-Plain">name &quot;mymap&quot;</span>
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">bitmap &quot;../mymap.pgm&quot;</span>
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">size [ map_width map_length 0.0 ]</span> <span class="c1">#the real size in meters (from yaml, resolution*pixels)</span>
</span><span class="hll">  <span class="l l-Scalar l-Scalar-Plain">pose [ width_offset length_offset 0.0 0.0 ]</span>
</span><span class="l l-Scalar l-Scalar-Plain">)</span>

<span class="l l-Scalar l-Scalar-Plain"># throw in a robot</span>
<span class="l l-Scalar l-Scalar-Plain">turtlebot</span>
<span class="hll"><span class="l l-Scalar l-Scalar-Plain">(</span>
</span>  <span class="l l-Scalar l-Scalar-Plain">pose [x_init y_init 0.0 0.0 ]</span>
  <span class="l l-Scalar l-Scalar-Plain">name &quot;turtlebot&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">color &quot;red&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">)</span>
 <span class="l l-Scalar l-Scalar-Plain">.....</span>
</pre></div>
</td></tr></table></div>
<p>First, change <code class="docutils literal"><span class="pre">`psu</span></code> and <code class="docutils literal"><span class="pre">psu.pgm</span></code> in Lines 4 and 5 as shown. Line 4 assigns a name to the floor plan, and Line 5 refer to the map itself, in our case <code class="docutils literal"><span class="pre">mymap.pgm</span></code>.
Finding the size is important. The size can be determined from two information from the <code class="docutils literal"><span class="pre">yaml</span></code> file, namely, the <code class="docutils literal"><span class="pre">resolution</span></code> and the <code class="docutils literal"><span class="pre">pixel</span> <span class="pre">width</span></code> and the <code class="docutils literal"><span class="pre">pixel</span> <span class="pre">length</span></code>.
For example, in case of <code class="docutils literal"><span class="pre">psu.yaml</span></code> file, we have a <code class="docutils literal"><span class="pre">resolution</span> <span class="pre">=</span> <span class="pre">0.05</span></code> and from the <code class="docutils literal"><span class="pre">pgm</span></code> file, the image of the map has  <code class="docutils literal"><span class="pre">(837*477)</span> <span class="pre">(pixels^2)</span></code>.
Multiplying by the resolution, we get the size of the map as <code class="docutils literal"><span class="pre">(41.85</span> <span class="pre">*</span> <span class="pre">23.85)</span> <span class="pre">m^2</span></code>. So,in the case of psu map, width_map = 41.85 m and length_map=23.85 m.</p>
<p>For the width and length offsets, we generally set them to the half of the width and length respectively, in this case will be <code class="docutils literal"><span class="pre">(20.925,</span> <span class="pre">11.925)</span></code>.
Then you set the initial position of the robot of your choice. For this, you can choose any position that would not conflict with an obstacle.</p>
<p>In case of psu, we set the initial position to the center of the map <code class="docutils literal"><span class="pre">(20.925,</span> <span class="pre">11.925)</span></code> as a choice. Other choices would also work.</p>
<ul class="simple">
<li>Step 5. finally, make sure to put the same initial location in the file <code class="docutils literal"><span class="pre">map_navigation_maymap.launch</span></code>,</li>
</ul>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;base&quot;</span>       <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_BASE kobuki)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- create, rhoomba --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;stacks&quot;</span>     <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_STACKS hexagons)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- circles, hexagons --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;3d_sensor&quot;</span>  <span class="na">default=</span><span class="s">&quot;$(optenv TURTLEBOT_3D_SENSOR kinect)&quot;</span><span class="nt">/&gt;</span>  <span class="c">&lt;!-- kinect, asus_xtion_pro --&gt;</span>

  <span class="c">&lt;!-- Name of the map to use (without path nor extension) and initial position --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;map_file&quot;</span>       <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/mymap.yaml&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- psu --&gt;</span>
  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;world_file&quot;</span>     <span class="na">default=</span><span class="s">&quot; $(find gaitech_edu)/src/maps/stage/mymap.world&quot;</span><span class="nt">/&gt;</span>
<span class="hll">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_x&quot;</span> <span class="na">default=</span><span class="s">&quot;x_init&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_y&quot;</span> <span class="na">default=</span><span class="s">&quot;y_init&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll">  <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;initial_pose_a&quot;</span> <span class="na">default=</span><span class="s">&quot;0.0&quot;</span><span class="nt">/&gt;</span>
</span></pre></div>
</td></tr></table></div>
<p>Now, you should be able to run the simulator with your own map.</p>
<div class="section" id="running-on-a-real-robot">
<h3>Running on a real robot<a class="headerlink" href="#running-on-a-real-robot" title="Permalink to this headline">¶</a></h3>
<p>To deploy on a real robot, you simply need to build a map as mentioned in the <a class="reference internal" href="create-map-kenict.html#create-map"><span class="std std-ref">Building a Map with a Turtlebot</span></a> tutorial and after saving the map on your Turtlebot&#8217;s PC bring-up your turtlebot robot, and then follow the previous steps to save some locations of interest. After that execute the following commands:</p>
<div class="section" id="on-your-turtlebot-s-pc">
<h4>On your Turtlebot&#8217;s PC<a class="headerlink" href="#on-your-turtlebot-s-pc" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roscore
roslaunch turtlebot_bringup minimal.launch
roslaunch turtlebot_navigation amcl_demo.launch map_file:<span class="o">=</span>/your_path/your_map.yaml
</pre></div>
</div>
</div>
<div class="section" id="on-your-workstation">
<h4>On your Workstation<a class="headerlink" href="#on-your-workstation" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_rviz_launchers view_navigation.launch
rosrun sound_play soundplay_node.py
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">Python</span></code> run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python your_path/gaitech_edu/src/turtlebot/navigation/map_navigation/scripts/map_navigation.py
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">C++</span></code> run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rosrun gaitech_edu map_navigation_node
</pre></div>
</div>
<p>In the latter case, You must make sure to have correctly configured your network settings as explained in the <a class="reference internal" href="network-config-doc.html#network-config-doc"><span class="std std-ref">Network Configuration</span></a> tutorial.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>The following links are for more information about:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://wiki.ros.org/map_server">Map Server in ROS</a></li>
<li><a class="reference external" href="http://wiki.ros.org/navigation">ROS Navigation</a></li>
<li><a class="reference external" href="http://wiki.ros.org/global_planner">Global Planner</a></li>
<li><a class="reference external" href="http://wiki.ros.org/base_local_planner">Local Planner</a></li>
<li><a class="reference external" href="http://wiki.ros.org/navigation/Tutorials">ROS Navigation Tutorials</a></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="review-questions-and-activity">
<h2>Review Questions and Activity<a class="headerlink" href="#review-questions-and-activity" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><strong>Question 1.</strong> What is the ROS topic that is used to find the location of the robot?</li>
<li><strong>Question 2.</strong> Explain the difference between these two codes:</li>
</ul>
</div></blockquote>
<p><strong>Code 1</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">move_base_msgs</span><span class="o">::</span><span class="n">MoveBaseGoal</span> <span class="n">goal</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">&quot;base_footprint&quot;</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span>  <span class="mf">2.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Code 2</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">move_base_msgs</span><span class="o">::</span><span class="n">MoveBaseGoal</span> <span class="n">goal</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">&quot;map&quot;</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">ros</span><span class="o">::</span><span class="n">Time</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span>  <span class="mf">2.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span>  <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">goal</span><span class="p">.</span><span class="n">target_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Question 3.</strong> Consider the following <code class="docutils literal"><span class="pre">yaml</span></code> for a map.</li>
</ul>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/my_map.pgm</span>
<span class="l l-Scalar l-Scalar-Plain">resolution</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.050000</span>
<span class="l l-Scalar l-Scalar-Plain">origin</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">0.00000</span><span class="p p-Indicator">,</span> <span class="nv">0.00000</span><span class="p p-Indicator">,</span> <span class="nv">0.000000</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">negate</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="l l-Scalar l-Scalar-Plain">occupied_thresh</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.65</span>
<span class="l l-Scalar l-Scalar-Plain">free_thresh</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.196</span>
</pre></div>
</div>
<p>Given that <code class="docutils literal"><span class="pre">my_map.pgm</span></code> has the size 540x680 pixels, what is the size in meters for the environment?</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="free-space-navigation.html" class="btn btn-neutral float-right" title="Turtlebot Free Space Navigation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create-map-kenict.html" class="btn btn-neutral" title="Building a Map with a Turtlebot" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gaitech.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>