<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Turtlebot Free Space Navigation</title>
    
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> 
  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="openCV-turtlebot.html" title="ROS OpenCV with Turtlebot"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="send-goals-nav-stack.html" title="Sending Goals to the Navigation Stack"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Gaitech EDU 2.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="turtlebot-tutorials.html" accesskey="U">Turtlebot Quick Start Tutorials</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="turtlebot-free-space-navigation">
<span id="free-space-navigation"></span><h1>Turtlebot Free Space Navigation</h1>
<p>This tutorial is the first lesson in the series of robot navigation. We consider the case of an open space with no obstacles.</p>
<p>The objective of this tutorial is to learn how to make the Turtlebot robot move using ROS. You will mainly learn how to publish a velocity message to make the robot move for a certain distance, or rotate for a certain angle.
For this, you will create the functions <code class="docutils literal"><span class="pre">move</span></code> and <code class="docutils literal"><span class="pre">rotate</span></code> using different techniques.
In particular, you will learn how to use <code class="docutils literal"><span class="pre">TF</span></code> package to estimate the distance traveled by the robot and the angle rotated by the robot using frame transformations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this tutorial you will learn how to:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Make the robot navigate in an open obstcale-free space</li>
<li>Develop functions to make the robot move straight for a certain distance</li>
<li>Develop functions to make the robot rotate for a certain angle.</li>
<li>use <code class="docutils literal"><span class="pre">TF</span></code> package to estimate the traveled distance and the rotated angle by a robot</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="background">
<h2>Background</h2>
<p>The objective is to develop functions to make the robot moves in an open space in straight line for a certain distance, and rotate left or right for certain angle.
Using these primitives, it is possible to make the robot move in a free space.</p>
<p>In <a class="reference internal" href="../ros/ros-programming-turtlesim.html#ros-programming-turtlesim"><span class="std std-ref">Turtlesim Cleaning Application</span></a> tutorial, we used the simple equation of <code class="docutils literal"><span class="pre">distance=time*speed</span></code> to make the robot move to a certain distance.
However, this method is not effective in case of a real robot considering the following reason: the inaccuracy of IMU sensor data that provide the speed of the robot in addition to the friction with the ground will
compromise the accuracy of the calculated traveled distance in a certain time duration, which results in an estimation error. This issue is even worse in case of rotation. This estimation error will quickly cumulate over time leading to inacceptable localization error.
Fortunately, in ROS, there is the frame transformation package, denoted as <code class="docutils literal"><span class="pre">tf</span></code> package, that provides several interesting and advanced functionalities to estimate the motion of a frame (in this case the frame attached to the robot), with respect to a fixed frame (i.e the reference frame).
In this tutorial, we will use the <code class="docutils literal"><span class="pre">tf</span></code> package to estimate the traveled distance of the robot, in addition to the rotated angle of the robot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is important to have a prior knowledge on frame transformation first to understand the code. Check some online tutorials or ask your instructor.</p>
</div>
</div>
<div class="section" id="c-and-python-code-for-the-square-path">
<h2>C++ and Python Code for the square path</h2>
<p>You can find the whole <code class="docutils literal"><span class="pre">cpp</span></code> and <code class="docutils literal"><span class="pre">python</span></code> files in our <a class="reference external" href="https://github.com/aniskoubaa/gaitech_doc">GitHub repository</a><span class="link-target"> [https://github.com/aniskoubaa/gaitech_doc]</span> in the following <a class="reference external" href="https://github.com/aniskoubaa/gaitech_doc/tree/master/src/turtlebot/navigation/free_space_navigation">path</a><span class="link-target"> [https://github.com/aniskoubaa/gaitech_doc/tree/master/src/turtlebot/navigation/free_space_navigation]</span>.
They are located in <code class="docutils literal"><span class="pre">src/turtlebot/navigation/free_space_navigation</span></code>. Go to <cite>scripts</cite> to find the <code class="docutils literal"><span class="pre">python</span></code> code.</p>
<p>In the code you will find 3 <code class="docutils literal"><span class="pre">move</span></code> methods and each one of them has its approach so you will be able to know 3 different ways of controlling and manipulating the turtlebot robot . The code is also well explained so you can easily understand what each line is doing in the code and what is its functionality.</p>
<p>After downloading the repository make sure you place it in your <code class="docutils literal"><span class="pre">catkin_ws/src</span></code> then run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>catkin_make
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may find a couple of errors due to your need to install missing packages.</p>
</div>
</div>
<div class="section" id="anaylzing-the-code">
<h2>Anaylzing the code</h2>
<p>We first analyze the <code class="docutils literal"><span class="pre">move</span></code> function to make the robot moves with a certain speed for a certain distance in stragight line either forward or backward.</p>
<p>The following code below sets the linear speed of the x-axis as positive value if the intention is to move forward, and negative value if the robot is to move backward, based on the value of <code class="docutils literal"><span class="pre">isForward</span></code> boolean variable. All other liear speeds and angular speeds must be set to zero.
It has to be noted that the x-axis of the linear speed is the axis that points to the front of the robot from its center.</p>
<p><strong>C++ Code</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span></span> <span class="c1">//set the linear velocity to a positive value if isFoward is true</span>
<span class="k">if</span> <span class="p">(</span><span class="n">isForward</span><span class="p">)</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span><span class="n">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
<span class="k">else</span> <span class="c1">//else set the velocity to negative value to move backward</span>
   <span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=-</span><span class="n">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
<span class="c1">//all velocities of other axes must be zero.</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">//The angular velocity of all axes must be zero because we want  a straight motion</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">VelocityMessage</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Python Code</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">isForward</span><span class="p">):</span>
        <span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> <span class="c1">#else set the velocity to negative value to move backward</span>
        <span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=-</span><span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
<span class="c1">#all velocities of other axes must be zero.</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span><span class="mf">0.0</span>
<span class="n">VelocityMessage</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span><span class="mf">0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-code-using-stage-and-rviz-simulators">
<h2>Running the code using Stage and RViz Simulators</h2>
<p>Bring up your simulator:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_stage turtlebot_in_stage.launch
</pre></div>
</div>
<p>If your PC is not fast enough to run the <cite>Stage</cite> with <cite>RViz</cite> you can run only the <cite>Stage</cite> using this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_stage turtlebot_in_stage_no_rviz.launch
</pre></div>
</div>
<p>After that run the <code class="docutils literal"><span class="pre">cpp</span></code> node by typing the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc free_space_navigation
</pre></div>
</div>
<p>or launch the <code class="docutils literal"><span class="pre">free_space_navigation_stage.launch</span></code> file to launch both simulators and the <code class="docutils literal"><span class="pre">cpp</span></code> node.</p>
<img alt="../_images/stage-square-move-cpp.png" class="align-center" src="../_images/stage-square-move-cpp.png" />
<p>You can also choose to run the <code class="docutils literal"><span class="pre">python</span></code> script by running this command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python your_workspace/src/gaitech_doc/src/turtlebot/navigation/free_space_navigation/script/free_space_navigation.py
</pre></div>
</div>
<img alt="../_images/stage-square-move-python.png" class="align-center" src="../_images/stage-square-move-python.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You can try the three <code class="docutils literal"><span class="pre">move</span></code> methods by calling each one of them in the <code class="docutils literal"><span class="pre">moveSquare</span></code> method.
You can try the same codes with <cite>Gazebo</cite> simulator but you need to have a fast PC. All you have to do is to launch <cite>Gazebo</cite> by typing the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_gazebo turtlebot_world.launch
</pre></div>
</div>
<p class="last">Then run either one of the files as mentioned above.</p>
</div>
<iframe width="640" height="360" src="http://www.youtube.com/embed/SHPCyqFDr1Q" frameborder="0" allowfullscreen="1">&nbsp;</iframe></div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Gaitech.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>