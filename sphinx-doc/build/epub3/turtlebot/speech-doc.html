<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Turtlebot Voice Teleoperation</title>
    
    <link rel="stylesheet" href="../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> 
  </head>
  <body role="document">

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="line-follower.html" title="Turtlebot Line Follower"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="teleop-doc.html" title="Keyboard Teleop"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Gaitech EDU 2.5 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="turtlebot-tutorials.html" accesskey="U">Turtlebot Quick Start Tutorials</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="turtlebot-voice-teleoperation">
<span id="speech-doc"></span><h1>Turtlebot Voice Teleoperation</h1>
<p>This tutorial will introduce how to control your turtlebot robot using speech recognition.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you completed installing all the required packages in the previous tutorials and your network set-up is working fine between the ROS Master node and the Host node.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In this tutorial you will learn how to:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Teleoprate a real and simulated turtlebot with voice commands</li>
<li>Create a custom voice-command vocabulary</li>
<li>Work with pocket-sphinx package in ROS</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="install-pocketsphinx-for-speech-recognition">
<h2>Install PocketSphinx for Speech Recognition</h2>
<p>In order to download the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package on Ubuntu you need to install the <code class="docutils literal"><span class="pre">gstreamer0.10-pocketsphinx</span></code> and the ROS sound drivers.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install gstreamer0.10-pocketsphinx
sudo apt-get install ros-indigo-pocketsphinx
sudo apt-get install ros-indigo-audio-common
sudo apt-get install libasound2
</pre></div>
</div>
<p>You do not need to worry about connecting the audio input stream with your PC or publishing a topic because the node recognizer.py in the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package does all the work for you.</p>
</div>
<div class="section" id="test-the-pocketsphinx-recognizer">
<h2>Test the PocketSphinx Recognizer</h2>
<p>First, you need to test if the recognizer is working. To get the best result it is better to have an external Mic connected to you PC either by USB, standard audio or Bluetooth.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure that the Mic you are using is the one that is selected in the sound settings in your PC. Try to test your Mic before hands to make sure that the quality is good and check the volume meter.</p>
</div>
<p>Note that <code class="docutils literal"><span class="pre">pocketsphinx</span></code> comes as a packages in ROS Indigo. For more details, refer to the <a class="reference external" href="http://wiki.ros.org/pocketsphinx">pocketsphinx package</a><span class="link-target"> [http://wiki.ros.org/pocketsphinx]</span> on ROS WiKi.
You can browse the directory of <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package with the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roscd pocketsphinx
</pre></div>
</div>
<p>In the directory <code class="docutils literal"><span class="pre">demo/</span></code>, you can observe the voice commands and dictionary. You may want to have a look at their content using <code class="docutils literal"><span class="pre">more</span></code> or <code class="docutils literal"><span class="pre">nano</span></code> text viewers.
Then, run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch pocketsphinx robocup.launch
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">robocup.dic</span></code> contains the following code:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recognizer&quot;</span> <span class="na">pkg=</span><span class="s">&quot;pocketsphinx&quot;</span> <span class="na">type=</span><span class="s">&quot;recognizer.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lm&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find pocketsphinx)/demo/robocup.lm&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;dict&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find pocketsphinx)/demo/robocup.dic&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>This command will run the <code class="docutils literal"><span class="pre">recognizer.py</span></code> script with loading the dictionary <code class="docutils literal"><span class="pre">robocup.dic</span></code>.
A list of INFO messages will appear showing the loading of the recognition model. The last few messages will look like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>INFO: ngram_search_fwdtree.c<span class="o">(</span>186<span class="o">)</span>: Creating search tree
INFO: ngram_search_fwdtree.c<span class="o">(</span>191<span class="o">)</span>: before: <span class="m">0</span> root, <span class="m">0</span> non-root channels, <span class="m">12</span> single-phone words
INFO: ngram_search_fwdtree.c<span class="o">(</span>326<span class="o">)</span>: after: max nonroot chan increased to 328
INFO: ngram_search_fwdtree.c<span class="o">(</span>338<span class="o">)</span>: after: <span class="m">77</span> root, <span class="m">200</span> non-root channels, <span class="m">11</span> single-phone words
</pre></div>
</div>
<p>Now, you can start saying some words to check if the recognizer will be able to understand what you are saying. For example, try to say the following words:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">hello</span>
<span class="n">go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">room</span>
<span class="n">my</span> <span class="n">name</span> <span class="ow">is</span>
<span class="n">door</span>
<span class="n">follow</span> <span class="n">room</span>
</pre></div>
</div>
<p>You can also try different words.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It might be possible that the recognizer will detect words different from what you pronounced. This may be due to (1) bad microphone, in this case try to get a high-quality microphone, (2) your pronounciation is not clear enough. In this case, try to repeat the word.</p>
</div>
<p>If the recognizer successfuly detected your spoken word, you can move to the next step to talk to your robot.</p>
<p>The spoken words found by the recognizer will be published to the topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code>. Type</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rostopic <span class="nb">echo</span> /recognizer/output
</pre></div>
</div>
<p>in another terminal to see the results as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>data: go to the room
--
data: hello
--
</pre></div>
</div>
<p>To see all the predefined commands in the RoboCup demo, run the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roscd pocketsphinx/demo
more robocup.corpus
</pre></div>
</div>
<p>Try saying a word that is not in the list such as &#8220;the food is hot&#8221; and see the results on the topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code>, which will show something different. The recognizer will always try to find the nearest match to the word you say.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you mute the recognizer when you are not using it because this will send random data to the robot.</p>
</div>
</div>
<div class="section" id="code-and-dependencies">
<h2>Code and dependencies</h2>
<p>The scripts of voice teleoperation can be found in <code class="docutils literal"><span class="pre">gaitech_doc/src/turtlebot/voice_teleop/</span></code> that you imported from GITHUB. Make sure that you imported the code from GITHUB.
If you did not import the code from GITHUB, you can still create a new ROS package as follow:
* Go to your catkin workspace and then go to <code class="docutils literal"><span class="pre">~/catkin_ws/src/</span></code>
* Create new a ROS package called <code class="docutils literal"><span class="pre">gaitech_doc</span></code> (or choose any other name) which depends on <code class="docutils literal"><span class="pre">pocketsphinx</span></code>, <code class="docutils literal"><span class="pre">roscpp</span></code>, <code class="docutils literal"><span class="pre">rospy</span></code>, <code class="docutils literal"><span class="pre">sound_play</span></code> and <code class="docutils literal"><span class="pre">std_msgs</span></code> as follow:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>catkin_create_pkg gaitech_doc roscpp rospy pocketsphinx sound_play std_msgs
</pre></div>
</div>
<ul class="simple">
<li>In the <code class="docutils literal"><span class="pre">~/catkin_ws/src/</span></code>, write the following command to see all the files and folders created:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>tree gaitech_doc
</pre></div>
</div>
<ul class="simple">
<li>Now, compile your newly added package:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/catkin_ws
~/catkin_ws$ catkin_make
</pre></div>
</div>
<ul class="simple">
<li>Finally, open your <code class="docutils literal"><span class="pre">package.xml</span></code> file and add all the required dependencies (otherwise, your project will not find required packages):</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Remove the commented parts --&gt;</span>
<span class="nt">&lt;package&gt;</span>
 <span class="nt">&lt;name&gt;</span>gaitech_doc<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
 <span class="nt">&lt;description&gt;</span>gaitech_doc<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;maintainer</span> <span class="na">email=</span><span class="s">&quot;ros@todo.todo&quot;</span><span class="nt">&gt;</span>ros<span class="nt">&lt;/maintainer&gt;</span>
 <span class="nt">&lt;license&gt;</span>TODO<span class="nt">&lt;/license&gt;</span>
 <span class="nt">&lt;buildtool_depend&gt;</span>catkin<span class="nt">&lt;/buildtool_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>pocketsphinx<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>roscpp<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>rospy<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>sound_play<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;build_depend&gt;</span>std_msgs<span class="nt">&lt;/build_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>pocketsphinx<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>roscpp<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>rospy<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>sound_play<span class="nt">&lt;/run_depend&gt;</span>
 <span class="nt">&lt;run_depend&gt;</span>std_msgs<span class="nt">&lt;/run_depend&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</pre></div>
</div>
<p>Now, you are done with creating the ROS package.</p>
</div>
<div class="section" id="create-your-vocabulary-of-commands">
<h2>Create Your Vocabulary of Commands</h2>
<p>In this section, you will learn how to add a vocabulary or corpus as it is specified in the <code class="docutils literal"><span class="pre">PocketSphinx</span></code>.
In partiuclar, we will create a simple vocabulary of commands to move the turtlebot robot forward, backward, and rotate it left and right.</p>
<p>Create a folder and call it <code class="docutils literal"><span class="pre">config</span></code> and inside this folder create a <code class="docutils literal"><span class="pre">txt</span></code> file called <code class="docutils literal"><span class="pre">motion_commands.txt</span></code>
and put the following commands (which you can extend later) for the robot motion:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">move</span> <span class="n">forward</span>
<span class="n">move</span> <span class="n">backwards</span>
<span class="n">turn</span> <span class="n">right</span>
<span class="n">turn</span> <span class="n">left</span>
</pre></div>
</div>
<p>Feel free to add/delete/change any command you want as long as you follow the conventions.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Do not use punctuation marks and pay attention to the upper and lower case letters.
If you want to add a number you will have to spell it so you can not write 1, 55, 87..etc instead write one, fifty five, eighty seven.</p>
</div>
<p>After editing the <code class="docutils literal"><span class="pre">motion_commands.txt</span></code> file, you have to compile it into special dictionary and pronounciation files so it matches the specification for the <code class="docutils literal"><span class="pre">PocketSphinx</span></code>.
The online CMU language model (lm) tool is very useful in this case, visit their <a class="reference external" href="http://www.speech.cs.cmu.edu/tools/lmtool-new.html">website</a><span class="link-target"> [http://www.speech.cs.cmu.edu/tools/lmtool-new.html]</span>  and  upload your file.
Click on the Compile Knowledge Base button, then download the file labeled <code class="docutils literal"><span class="pre">COMPRESSED</span> <span class="pre">TARBALL</span></code> that contains all the language model files
that you need and the <code class="docutils literal"><span class="pre">PocketSphinx</span></code> can understand.</p>
<p>Extract these files into the config subdirectory of the <code class="docutils literal"><span class="pre">gaitech_doc</span></code> package (or your package where you are working this example). These files must be provided as an input parameter to <code class="docutils literal"><span class="pre">recognizer.py</span></code> node.
To do so, you need to create a launch file as follow.</p>
<blockquote>
<div><ul class="simple">
<li>First, create a folder and call it <code class="docutils literal"><span class="pre">launch</span></code> where to create launch files</li>
<li>Then, create a file called <code class="docutils literal"><span class="pre">recognizer.launch</span></code>, and add the following XML code:</li>
</ul>
</div></blockquote>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;launch&gt;</span>
     <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recognizer&quot;</span> <span class="na">pkg=</span><span class="s">&quot;pocketsphinx&quot;</span> <span class="na">type=</span><span class="s">&quot;recognizer.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lm&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/turtlebot/voice_teleop/config/motion_commands.lm&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;dict&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/turtlebot/voice_teleop/config/motion_commands.dic&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your package name is different from <code class="docutils literal"><span class="pre">gaitech_doc</span></code> make sure to consider this in the instruction <code class="docutils literal"><span class="pre">value=&quot;$(find</span> <span class="pre">gaitech_doc)</span></code> of the launch file. Otherwise, ROS will not be able to find the parameters.
Make sure that you put the correct path for the <code class="docutils literal"><span class="pre">lm</span></code> and <code class="docutils literal"><span class="pre">dic</span></code> files.</p>
</div>
<p>This file runs the <code class="docutils literal"><span class="pre">recognizer.py</span></code> node from the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package mentioned before in this tutorial.
The last parameter which is <code class="docutils literal"><span class="pre">output=&quot;screen&quot;</span></code> is used to let us see in real-time the recognition results in the launch window.</p>
<p>Launch the <code class="docutils literal"><span class="pre">recognizer.launch</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc recognizer.launch
</pre></div>
</div>
<p>and in another terminal run the following command to see the published topics after giving the robot a couple of commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rostopic <span class="nb">echo</span> /recognizer/output
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure to close all the running launch files and all the demos running from previous examples before you run the previous commands.</p>
</div>
</div>
<div class="section" id="a-voice-control-navigation-script">
<h2>A Voice-Control Navigation Script</h2>
<p>In this section, we will present a small program <code class="docutils literal"><span class="pre">src/turtlebot/voice_teleop/voice_teleop.py</span></code> (<code class="docutils literal"><span class="pre">voice_teleop.cpp</span></code> for C++) that will allow you to control your turtlebot robot using voice commands.
The idea is simple. The program will subscribe to the topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code>, which is published by the node <code class="docutils literal"><span class="pre">recognizer.py</span></code> node of the <code class="docutils literal"><span class="pre">pocketsphinx</span></code> package using the dictionary of words that we create above.
Once a command is received, the callback function of the subscribed topic <code class="docutils literal"><span class="pre">/recognizer/output</span></code> will be executed to set the velocity of the robot based on the command received.</p>
</div>
<div class="section" id="code-explanation">
<h2>Code Explanation</h2>
<p>This is the content of the <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> file in <code class="docutils literal"><span class="pre">src/turtlebot/voice_teleop/</span></code> directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">RobotVoiceTeleop</span><span class="p">:</span>
    <span class="c1">#define the constructor of the class</span>
    <span class="k">def</span>  <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#initialize the ROS node with a name voice_teleop</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;voice_teleop&#39;</span><span class="p">)</span>

        <span class="c1"># Publish the Twist message to the cmd_vel topic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s1">&#39;/cmd_vel&#39;</span><span class="p">,</span> <span class="n">Twist</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Subscribe to the /recognizer/output topic to receive voice commands.</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;/recognizer/output&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice_command_callback</span><span class="p">)</span>

        <span class="c1">#create a Rate object to sleep the process at 5 Hz</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Initialize the Twist message we will publish.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
        <span class="c1">#make sure to make the robot stop by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>



        <span class="c1"># A mapping from keywords or phrases to commands</span>
        <span class="c1">#we consider the following simple commands, which you can extend on your own</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span>             <span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;forward&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;backward&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;turn left&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;turn right&#39;</span><span class="p">,</span>
                                <span class="p">]</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Ready to receive voice commands&quot;</span><span class="p">)</span>
        <span class="c1"># We have to keep publishing the cmd_vel message if we want the robot to keep moving.</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="p">)</span>
            <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">voice_command_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c1"># Get the motion command from the recognized phrase</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;backward&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;turn left&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;turn right&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1">#command not found</span>
            <span class="c1">#print &#39;command not found: &#39;+command</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;linear speed : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;angular speed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_vel</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>



<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">RobotVoiceTeleop</span><span class="p">()</span>
      <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSInterruptException</span><span class="p">:</span>
      <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s2">&quot;Voice navigation terminated.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To execute the code, we create the following launch file called <code class="docutils literal"><span class="pre">turtlebot_voice_teleop_stage.launch</span></code> that will run the <code class="docutils literal"><span class="pre">recognizer.py</span></code> node, <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> node and <code class="docutils literal"><span class="pre">turtlebot_stage</span></code> simulator.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span> <span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;recognizer&quot;</span> <span class="na">pkg=</span><span class="s">&quot;pocketsphinx&quot;</span> <span class="na">type=</span><span class="s">&quot;recognizer.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;lm&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/src/turtlebot/voice_teleop/config/motion_commands.lm&quot;</span><span class="nt">/&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;dict&quot;</span> <span class="na">value=</span><span class="s">&quot;$(find gaitech_doc)/src/turtlebot/voice_teleop/config/motion_commands.dic&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/node&gt;</span>

   <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">&quot;voice_teleop&quot;</span> <span class="na">pkg=</span><span class="s">&quot;gaitech_doc&quot;</span> <span class="na">type=</span><span class="s">&quot;voice_teleop.py&quot;</span> <span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">&quot;/cmd_vel&quot;</span> <span class="na">to=</span><span class="s">&quot;/cmd_vel_mux/input/teleop&quot;</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/node&gt;</span>

   <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find turtlebot_stage)/launch/turtlebot_in_stage.launch&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<p>The first node starts the <code class="docutils literal"><span class="pre">recognizer.py</span></code> with the <code class="docutils literal"><span class="pre">motion_command</span></code> dictionary that we created previously.
The scond node starts the <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> node that will receives the voice commands and map them to velocities.
The third node starts the <code class="docutils literal"><span class="pre">turtlebot_in_stage</span></code> simulator and brings-up the turtlebot robot in simulatiion. This is equivalent to the command <code class="docutils literal"><span class="pre">roslaunch</span> <span class="pre">turtlebot_stage</span> <span class="pre">turtlebot_in_stage.launch</span></code>. It also possible to run the <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> node with Turtlebot Gazebo simulator by changing the last line of the launch file with</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span>
...
  <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">&quot;$(find turtlebot_gazebo)/launch/turtlebot_world.launch&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It is important to note the topic remapping instruction <code class="docutils literal"><span class="pre">&lt;remap</span> <span class="pre">from=&quot;/cmd_vel&quot;</span> <span class="pre">to=&quot;/cmd_vel_mux/input/teleop&quot;/&gt;</span></code> in the launch file for the <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> node.
In fact, the <code class="docutils literal"><span class="pre">voice_teleop.py</span></code> node publishes velocities to the topic <code class="docutils literal"><span class="pre">/cmd_vel</span></code>, whereas the turtlebot_stage simulator wait for velocities on the topic <code class="docutils literal"><span class="pre">/cmd_vel_mux/input/teleop</span></code>.
This is the reason why we need to remap  the topic <code class="docutils literal"><span class="pre">/cmd_vel</span></code> to <code class="docutils literal"><span class="pre">/cmd_vel_mux/input/teleop</span></code>. For more information about the <code class="docutils literal"><span class="pre">&lt;remap&gt;</span></code> tag, refer to <a class="reference external" href="http://wiki.ros.org/roslaunch/XML/remap">&lt;remap&gt; page in ROS WiKi</a><span class="link-target"> [http://wiki.ros.org/roslaunch/XML/remap]</span>.</p>
</div>
</div>
<div class="section" id="testing-the-voice-control-in-the-gazebo-and-stage-simulators">
<h2>Testing the Voice-Control in the Gazebo and Stage Simulators</h2>
<p>To test the voice teleopration using <code class="docutils literal"><span class="pre">Turtlebot</span> <span class="pre">Stage</span> <span class="pre">simulator</span></code>, simply launch the launch file specified above as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc turtlebot_voice_teleop_stage.launch
</pre></div>
</div>
<img alt="../_images/voice_teleop_stage.png" class="align-center" src="../_images/voice_teleop_stage.png" />
<p>Or, if you want to test with <code class="docutils literal"><span class="pre">Turtlebot</span> <span class="pre">Gazebo</span> <span class="pre">Simulator</span></code>, simply run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc turtlebot_voice_teleop_gazebo.launch
</pre></div>
</div>
<img alt="../_images/voice_teleop_gazebo.png" class="align-center" src="../_images/voice_teleop_gazebo.png" />
<p>This is equivalent to running the following three commands in three terminals:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc recognizer.launch
rosrun gaitech_doc voice_teleop.py
roslaunch turtlebot_stage turtlebot_in_stage.launch
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>These simulators requires a powerful PC with a good graphics card that can launch them. They also may crash once you start them but don&#8217;t worry this is very normal, just rerun the script until it launches.
Make sure to check your Mic settings as described above. If you got an error running the <code class="docutils literal"><span class="pre">recognizer</span></code> node then try installing the following package:</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install gstreamer0.10-gconf
</pre></div>
</div>
</div>
<p>To able to view the commands that are recognizable by the robot we have to run the <code class="docutils literal"><span class="pre">rqt_console</span></code> using the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rqt_console <span class="p">&amp;</span>
</pre></div>
</div>
<p>Now, test your robot by giving it any command from the list of commands you create above.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that it is possible that commands are not correctly recognized if your voice is not clear or your microphone is not good enough. Try with high quality microphone for more reliable results.</p>
</div>
<p>You can then update the code to add more commands, such as <code class="docutils literal"><span class="pre">faster</span></code>, to increase the speed of the robot, <code class="docutils literal"><span class="pre">slower</span></code>, to decrease the speed of the robot. The file  <code class="docutils literal"><span class="pre">voice_teleop_advanced.py</span></code> contains a more elaborated example with more commands.</p>
</div>
<div class="section" id="testing-the-voice-control-with-a-real-turtlebot-robot">
<h2>Testing the Voice-Control with a Real Turtlebot Robot</h2>
<p>Now, you will test the voice teleoperation with a real turtlebot robot.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before you test the robot make sure that your robot is in an open space with no obstacles or edges next to it.
Also, make sure that your computer machine is correctly configured to work with the Turtlebot laptop as in the <a class="reference internal" href="network-config-doc.html#network-config-doc"><span class="std std-ref">Network Configuration</span></a>.</p>
</div>
<p>From the ROS Master gaitech_doc laptop run the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch turtlebot_bringup minimal.launch
</pre></div>
</div>
<p>To make the monitoring process easier bring up <code class="docutils literal"><span class="pre">rqt_console</span></code> by running:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>rqt_console <span class="p">&amp;</span>
</pre></div>
</div>
<p>On the host node(the user PC) run the <code class="docutils literal"><span class="pre">voice_teleop.launch</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>roslaunch gaitech_doc voice_teleop.launch
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Try a simple command at first like the rotate right to avoid any accidents.
You can change the robot&#8217;s speed by giving the command &#8220;go faster&#8221; or &#8220;slow down&#8221; and this will change the parameters for speed in the <code class="docutils literal"><span class="pre">turtlebot_voice_teleop.launch</span></code> file.
However, you will have to add the commands as mentioned previously in the <code class="docutils literal"><span class="pre">config/voice_teleop.txt</span></code> file and redo all he steps again.</p>
</div>
</div>
<div class="section" id="video-demonstration">
<h2>Video Demonstration</h2>
<iframe width="640" height="360" src="http://www.youtube.com/embed/mZ4-HIYWWOI" frameborder="0" allowfullscreen="1">&nbsp;</iframe></div>
<div class="section" id="hands-on-activities">
<h2>Hands-on Activities</h2>
<p>In this section, you will extend the example above and implement a smarter version of the voice teleoperation application.</p>
<div class="section" id="question-1-extending-voice-vocabulary">
<h3>Question 1: Extending Voice Vocabulary</h3>
<p>Extend the example above to consider more voice commands to control the robot motion. Implement the following commands:</p>
<ul>
<li><p class="first">define the following variables:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">start_speed</span></code> : the initial speed used when starting the script.</li>
<li><code class="docutils literal"><span class="pre">linear_increment</span></code> : a certain increment to add/substract to linear velocity. The default value is 0.05</li>
<li><code class="docutils literal"><span class="pre">angular_increment</span></code> : a certain increment to add/substract the angular velocity. The default value is 0.4</li>
<li><code class="docutils literal"><span class="pre">max_speed</span></code>: the maximum linear velocity allowed</li>
<li><code class="docutils literal"><span class="pre">max_angular_speed</span></code> : the maximum angular velocity allowed</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>rotate left</strong>: makes the robot rotate to the left  (with a linear velocity equal to zero)</p>
</li>
<li><p class="first"><strong>rotate right</strong>: makes the robot rotate to the right  (with a linear velocity equal to zero)</p>
</li>
<li><p class="first"><strong>turn left</strong>: if the linear velocity is different from zero, it increases the angular velocity with <code class="docutils literal"><span class="pre">linear_increment</span></code>. If the linear velocity is zero, it sets the angular velocity to the default angular speed (e.g. 0.5)</p>
</li>
<li><p class="first"><strong>turn right</strong>: if the linear velocity is different from zero, it decreases the angular velocity with <code class="docutils literal"><span class="pre">angular_increment</span></code>. If the linear velocity is zero, it sets the angular velocity to the default negative angular speed (e.g. -0.5)</p>
</li>
<li><p class="first"><strong>slower</strong>: decreases the linear velocity by the increment <code class="docutils literal"><span class="pre">linear_increment``and</span> <span class="pre">the</span> <span class="pre">angular</span> <span class="pre">velocity</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">increment</span> <span class="pre">``angular_increment</span></code></p>
</li>
<li><p class="first"><strong>faster</strong>: increases the linear velocity by the increment <code class="docutils literal"><span class="pre">linear_increment``and</span> <span class="pre">the</span> <span class="pre">angular</span> <span class="pre">velocity</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">increment</span> <span class="pre">``angular_increment</span></code></p>
</li>
<li><p class="first"><strong>half</strong>: sets the linear and angular velocities to the half of their current values.</p>
</li>
<li><p class="first"><strong>full</strong>: sets the linear speeds to the maximum speed value</p>
</li>
</ul>
<p>Make sure that all speeds are within the range of the minimum and maximum speeds allowed.</p>
<p>After modification, test you code as illustrated above on both simulated and real turtlebot robot.</p>
</div>
<div class="section" id="question2-leveraging-the-use-of-launch-files">
<h3>Question2: Leveraging the Use of Launch Files</h3>
<p>The variables defined above <code class="docutils literal"><span class="pre">linear_increment</span></code>, <code class="docutils literal"><span class="pre">angular_increment</span></code>, <code class="docutils literal"><span class="pre">max_speed</span></code> and <code class="docutils literal"><span class="pre">max_angular_speed</span></code> are set based on the user&#8217;s preference.
It is more appropriate to set these values as parameters into the launch file and then read these parameters from your program or script before using them.</p>
<p>Modify the code so that to allow the user to define these parameters from the launch file.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You should use <code class="docutils literal"><span class="pre">rospy.get_param(&quot;~param_name&quot;,</span> <span class="pre">default_value)</span></code> in Python to read a parameter from a launch file and
use <code class="docutils literal"><span class="pre">nh.getParam(&quot;/global_name&quot;,</span> <span class="pre">global_name)</span></code>  in C++. For more details refer to <a class="reference external" href="http://wiki.ros.org/rospy/Overview/Parameter%20Server">Python Parameter Server</a><span class="link-target"> [http://wiki.ros.org/rospy/Overview/Parameter%20Server]</span>   and <a class="reference external" href="http://wiki.ros.org/roscpp/Overview/Parameter%20Server">C++ Parameter Server</a><span class="link-target"> [http://wiki.ros.org/roscpp/Overview/Parameter%20Server]</span>.</p>
</div>
</div>
<div class="section" id="question3-enabling-disabling-voice-teleopration">
<h3>Question3: Enabling/Disabling Voice Teleopration</h3>
<p>Now, you will add a new functionality to either enable or disable the voice teleopration.
For this, you need to add two keywords into the vocabulary.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">pause</span></code>: when the user says <code class="docutils literal"><span class="pre">pause</span></code> the voice teleoperation should be paused. It means even if the user says more voice commands, they will not be executed</li>
<li><code class="docutils literal"><span class="pre">resume</span></code>: when the user says <code class="docutils literal"><span class="pre">resume</span></code>, the voice teleopration is resumed and voice commands will be executed again.</li>
</ul>
</div></blockquote>
<p>Make necessary changes to provide these functionalities.</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Gaitech.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54522619-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>